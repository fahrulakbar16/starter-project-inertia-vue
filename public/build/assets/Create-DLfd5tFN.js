import{d as x,y as j,u as M,z as _,x as B,p as O,e as c,o as u,b as g,a as e,g as i,D as E,t as n,f as b,F as S,i as W,w as C,E as $,h as z,G as P,H as G}from"./app-CJkCV51W.js";import{_ as H}from"./AppLayout-BlEKf3Fz.js";import{_ as J}from"./Breadcrumb-BJQpsGcc.js";import K from"./Form-kgokLzy3.js";import{T as L}from"./TrashIcon-DSAHmBPH.js";import{_ as Q}from"./SelectBarang-CRvJrPbK.js";import{v as R}from"./v4-BKrj-4V8.js";import"./FlashMessage-D4C-FUm8.js";import"./LayoutShell-FWpWJLvi.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useAuth-DvuTgkfF.js";import"./LayoutShell.vue_vue_type_style_index_0_lang-CRqqKi3W.js";import"./SelectPemakaian-bo5sz744.js";const X={class:"flex overflow-hidden flex-col gap-3 px-3 h-full"},Y={class:"flex justify-between items-center h-10"},Z={class:"space-y-5 overflow-hidden rounded-lg border border-gray-200 bg-white p-6 dark:border-gray-700 dark:bg-white/[0.03]"},ee={class:"flex items-center justify-between"},te={class:"font-bold text-sky-400 md:text-xl px-7"},re={class:"overflow-hidden rounded-lg border border-gray-200 bg-white dark:border-gray-700 dark:bg-white/[0.03]"},se={class:"overflow-auto","data-simplebar":""},ae={class:"min-w-full text-sm"},oe={class:"w-4 py-2.5 border-y border-gray-200 dark:border-gray-600"},de={class:"flex items-center whitespace-nowrap justify-center"},ne={class:"px-5 py-2.5 border border-gray-200 dark:border-gray-600"},ie={class:"flex flex-col py-1"},le={class:"flex items-center justify-between"},ce={class:"font-medium text-gray-900 dark:text-gray-100 text-sm"},ue={key:0,class:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full"},me={class:"text-xs text-gray-500 dark:text-gray-400"},pe={key:0,class:"text-xs text-rose-600 mt-1"},ye={class:"py-2.5 border border-gray-200 dark:border-gray-600"},ge={class:"flex items-center px-3 whitespace-nowrap justify-center"},be={class:"text-gray-500 dark:text-gray-400"},xe={class:"py-2.5 border border-gray-200 dark:border-gray-600"},_e={class:"flex items-center px-3 whitespace-nowrap justify-center"},fe={class:"text-gray-500 dark:text-gray-400"},he={class:"py-2.5 border border-gray-200 dark:border-gray-600"},ke={class:"flex items-center gap-3 ps-6 whitespace-nowrap"},ve=["onUpdate:modelValue"],qe={key:0,class:"text-xs text-rose-600 mt-1"},we={class:"py-2.5 border border-gray-200 dark:border-gray-600"},je={class:"flex items-center whitespace-nowrap justify-center"},Be=["onUpdate:modelValue"],Se={key:0,class:"text-xs text-rose-600 mt-1"},Ce={class:"py-2.5 border-y border-gray-200 dark:border-gray-600"},$e={class:"flex justify-center whitespace-nowrap px-4 gap-3"},Pe=["onClick"],Re={key:0,class:"px-6 py-3 text-xs text-rose-600"},Ge=Object.assign({layout:H},{__name:"Create",props:{requestNo:String,user:Object,materialRequests:{type:Array,required:!0},departments:{type:Array,required:!0},employees:{type:Array,required:!0},items:{type:Array,default:()=>[]},sortBy:String,sortDirection:String,isSuperadmin:{type:Boolean,required:!0}},setup(p){const D=[{label:"Penyimpanan"},{label:"Pengajuan Pembelian",href:route("purchase-requests.index")},{label:"Buat Pengajuan"}],m=p,f=x(m.items.map(t=>({id:t.id,name:t.name,code:t.code,stock:t.stock,unit:t.unit,branch_id:t.branch_id}))),v=x(0),y=()=>{v.value++},T=j(()=>m.departments.find(t=>t.id===o.department_id)),h=j(()=>T.value?.branch_id??null),I=t=>{v.value;const s=l.value.map((r,a)=>a!==t&&r.item_id?.id?r.item_id.id:null).filter(r=>r!==null);return f.value.filter(r=>{const a=!s.includes(r.id),d=h.value?r.branch_id===h.value:!0;return a&&d})},N=(t,s)=>l.value.some((r,a)=>a!==s&&r.item_id?.id===t);function U(t){const s={id:Date.now(),name:t,code:"-",stock:0,branch_id:h.value??null};return f.value.push(s),s}function q(t){_(()=>t.item_id,s=>{console.log("bindWatcher - newVal:",s),s?(t.code=s.code,t.name=s.name,t.stock=s.stock?s.stock.last_stock:0,t.unit=s.unit):(t.code="",t.name="",t.stock=0,t.unit={})},{immediate:!0})}const l=x([]),V=()=>{const t=B({uid:R(),item_id:null,request:1,code:"",name:"",stock:0,unit:{},note:""});q(t),l.value.push(t),y()},A=t=>{l.value.splice(t,1),y()},o=M({request_no:m.requestNo,requested_at:new Date().toISOString().slice(0,10),department_id:m.user?.employee?.department?.id,employee_id:m.user?.employee?.id,request_id:null,requirement:"",requests:[]}),k=x(!1);_(()=>o.request_id,async t=>{if(!t){l.value=[];return}const s=m.materialRequests.find(r=>r.id===t);s&&(k.value=!0,o.department_id=s.department_id??"",o.requirement=s.requirement??"",l.value=s.items.map(r=>{const a=B({uid:R(),item_id:f.value.find(d=>d.id===r.item_id)??null,code:r.code,name:r.name,stock:r.stock?r.stock.last_stock:0,unit:r.unit,request:r.quantity_requested,note:r.note});return q(a),a}),await O(),k.value=!1)}),_(l,()=>{y()},{deep:!0}),_(()=>o.department_id,()=>{if(k.value){y();return}l.value.forEach(t=>{t.item_id=null,t.code="",t.name="",t.stock=0,t.unit={}}),y()});function F(){o.requests=l.value.map(t=>({uid:t.uid,item_id:t.item_id?.id??null,request:t.request,note:t.note??null})),o.post(route("purchase-requests.store"))}function w(){G.get(route("purchase-requests.index"))}return(t,s)=>(u(),c(S,null,[g(i(E),{title:"Buat Pengajuan Pembelian"}),e("div",X,[e("div",Y,[g(J,{items:D})]),e("div",Z,[e("div",ee,[s[0]||(s[0]=e("div",{class:"font-bold text-gray-700 md:text-xl dark:text-gray-300"}," Buat Pengajuan Pembelian ",-1)),e("div",te,n(i(o).request_no),1)]),g(K,{form:i(o),materialRequests:p.materialRequests,departments:p.departments,employees:p.employees,isSuperadmin:p.isSuperadmin,onCancel:w},null,8,["form","materialRequests","departments","employees","isSuperadmin"])]),e("div",re,[s[3]||(s[3]=e("div",{class:"flex items-center justify-between px-6 py-4"},[e("div",{class:"font-semibold text-gray-700 dark:text-gray-200"}," Daftar Item ")],-1)),e("div",se,[e("table",ae,[s[2]||(s[2]=e("thead",null,[e("tr",null,[e("th",{class:"py-2.5 border-y border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800"},[e("div",{class:"flex items-center justify-center"},[e("p",{class:"flex flex-col items-center font-medium text-gray-500 whitespace-nowrap dark:text-gray-400"}," No. ")])]),e("th",{class:"py-3 border cursor-pointer border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800"},[e("div",{class:"flex items-center justify-center gap-2 px-3"},[e("p",{class:"font-medium text-gray-500 whitespace-nowrap dark:text-gray-400"}," Nama Barang ")])]),e("th",{class:"py-3 border border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800"},[e("div",{class:"flex cursor-pointer items-center justify-center gap-2 px-3"},[e("p",{class:"font-medium whitespace-nowrap text-gray-500 dark:text-gray-400"}," Kode Barang ")])]),e("th",{class:"py-3 border cursor-pointer border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800"},[e("div",{class:"flex items-center justify-center gap-2 px-3"},[e("p",{class:"font-medium text-gray-500 whitespace-nowrap dark:text-gray-400"}," Stok Tersedia ")])]),e("th",{class:"py-3 border cursor-pointer border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800"},[e("div",{class:"flex items-center justify-center gap-2 px-3"},[e("p",{class:"font-medium text-gray-500 whitespace-nowrap dark:text-gray-400"}," Jumlah Pengajuan ")])]),e("th",{class:"py-3 border cursor-pointer border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800"},[e("div",{class:"flex items-center justify-center gap-2 px-3"},[e("p",{class:"font-medium text-gray-500 whitespace-nowrap dark:text-gray-400"}," Catatan ")])]),e("th",{class:"border-y border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800"},[e("div",{class:"flex items-center justify-center"},[e("p",{class:"font-medium text-gray-500 whitespace-nowrap dark:text-gray-400"}," Aksi ")])])])],-1)),e("tbody",null,[(u(!0),c(S,null,W(l.value,(r,a)=>(u(),c("tr",{key:r.uid,class:"hover:bg-gray-100 cursor-pointer dark:hover:bg-gray-800"},[e("td",oe,[e("div",de,n(a+1)+". ",1)]),e("td",ne,[g(Q,{modelValue:r.item_id,"onUpdate:modelValue":d=>r.item_id=d,items:I(a),taggable:!0,"search-key":"name","label-key":"name",label:"Cari Barang",onTag:U,class:"w-full"},{item:C(({item:d})=>[e("div",ie,[e("div",le,[e("span",ce,n(d.name),1),N(d.id,a)?(u(),c("span",ue," Dipilih ")):b("",!0)]),e("span",me,n(d.code||"-"),1)])]),"no-options":C(()=>[...s[1]||(s[1]=[e("div",{class:"text-sm text-gray-500 p-2"}," Semua barang telah dipilih di baris lain ",-1)])]),_:2},1032,["modelValue","onUpdate:modelValue","items"]),i(o).errors[`requests.${a}.item_id`]?(u(),c("div",pe,n(i(o).errors[`requests.${a}.item_id`][0]),1)):b("",!0)]),e("td",ye,[e("div",ge,[e("p",be,n(r.code),1)])]),e("td",xe,[e("div",_e,[e("p",fe,n(r.stock)+" "+n(r.unit?.short_name),1)])]),e("td",he,[e("div",ke,[$(e("input",{"onUpdate:modelValue":d=>r.request=d,type:"number",min:"0",class:"w-24 rounded border-gray-300 dark:border-gray-700 dark:bg-gray-800 dark:text-white/90"},null,8,ve),[[P,r.request]]),z(" "+n(r.unit?.short_name),1)]),i(o).errors[`requests.${a}.request`]?(u(),c("div",qe,n(i(o).errors[`requests.${a}.request`]),1)):b("",!0)]),e("td",we,[e("div",je,[$(e("input",{"onUpdate:modelValue":d=>r.note=d,type:"text",placeholder:"Masukkan catatan",class:"w-40 h-10 text-sm rounded placeholder:text-gray-600 border-gray-300 dark:border-gray-700 dark:bg-gray-800 dark:text-white/90"},null,8,Be),[[P,r.note]])]),i(o).errors[`requests.${a}.note`]?(u(),c("div",Se,n(i(o).errors[`requests.${a}.note`]),1)):b("",!0)]),e("td",Ce,[e("div",$e,[e("button",{onClick:d=>A(a)},[g(L,{class:"text-red-500"})],8,Pe)])])]))),128))])]),e("button",{type:"button",onClick:V,class:"m-4 px-3 py-2 text-white bg-green-500 hover:bg-green-600 rounded whitespace-nowrap"}," + Tambah Item ")]),i(o).errors.requests?(u(),c("div",Re,n(i(o).errors.requests[0]),1)):b("",!0)]),e("div",{class:"flex items-center gap-5 justify-end"},[e("button",{type:"button",onClick:w,class:"inline-flex items-center rounded border bg-gray-400 border-gray-300 px-5 py-2 text-sm text-white hover:text-gray-800 hover:bg-gray-300 dark:border-gray-700 dark:text-gray-300"}," Batal "),e("button",{onClick:F,class:"inline-flex items-center rounded bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 disabled:opacity-60"}," Buat Pengajuan ")])])],64))}});export{Ge as default};
