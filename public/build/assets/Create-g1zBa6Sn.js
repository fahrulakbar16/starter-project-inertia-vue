import{u as N,d as j,y as U,z as A,e as l,o as c,b as g,a as e,g as n,D as M,f as y,t as i,F as q,i as T,w as R,E as _,h as D,G as f,n as k,H as F}from"./app-CJkCV51W.js";import{_ as J}from"./AppLayout-BlEKf3Fz.js";import{_ as z}from"./Breadcrumb-BJQpsGcc.js";import E from"./Form-D5acvznD.js";import{T as H}from"./TrashIcon-DSAHmBPH.js";import{_ as K}from"./SelectBarang-CRvJrPbK.js";import"./FlashMessage-D4C-FUm8.js";import"./LayoutShell-FWpWJLvi.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useAuth-DvuTgkfF.js";import"./LayoutShell.vue_vue_type_style_index_0_lang-CRqqKi3W.js";import"./SelectPemakaian-bo5sz744.js";const G={class:"flex overflow-hidden flex-col gap-3 px-3 h-full"},L={class:"flex justify-between items-center h-10"},W={class:"space-y-5 overflow-hidden rounded-lg border border-gray-200 bg-white p-6 dark:border-gray-700 dark:bg-white/[0.03]"},Q={class:"flex items-center justify-between"},X={class:"font-bold text-sky-400 md:text-xl px-7"},Y={class:"overflow-hidden rounded-lg border border-gray-200 bg-white dark:border-gray-700 dark:bg-white/[0.03]"},Z={class:"overflow-auto","data-simplebar":""},ee={class:"min-w-full text-sm"},te={key:0},re={class:"w-4 py-2.5 border-y border-gray-200 dark:border-gray-600"},ae={class:"flex items-center whitespace-nowrap justify-center"},se={class:"px-5 py-2.5 border border-gray-200 dark:border-gray-600"},oe={key:0,class:"flex flex-col"},de={class:"font-medium text-gray-900 dark:text-gray-100"},ne={class:"text-xs text-gray-500 dark:text-gray-400"},ie={key:1,class:"flex flex-col"},le={class:"font-medium text-gray-900 dark:text-gray-100"},ce={class:"text-xs text-gray-500 dark:text-gray-400"},ue={key:0,class:"text-xs text-rose-600 mt-1"},me={class:"py-2.5 border border-gray-200 dark:border-gray-600"},ye={class:"flex items-center px-3 whitespace-nowrap justify-center"},pe={class:"text-gray-500 dark:text-gray-400"},be={class:"py-2.5 border border-gray-200 dark:border-gray-600"},ge={class:"flex items-center gap-3 ps-6 whitespace-nowrap"},he=["onUpdate:modelValue","onInput"],xe={key:0,class:"text-xs text-rose-600 mt-1"},_e={class:"py-2.5 border border-gray-200 dark:border-gray-600"},fe={class:"flex items-center gap-3 ps-6 whitespace-nowrap"},ke=["onUpdate:modelValue","onInput"],ve={key:0,class:"text-xs text-rose-600 mt-1"},we={class:"py-2.5 border border-gray-200 dark:border-gray-600"},je={class:"flex items-center px-3 whitespace-nowrap justify-center"},qe={class:"font-semibold text-gray-700 dark:text-gray-300"},Ie={class:"py-2.5 border border-gray-200 dark:border-gray-600"},Pe={class:"flex items-center whitespace-nowrap justify-center"},Se=["onUpdate:modelValue"],$e={key:0,class:"text-xs text-rose-600 mt-1"},Be={class:"py-2.5 border-y border-gray-200 dark:border-gray-600"},Ce={class:"flex justify-center whitespace-nowrap px-4 gap-3"},Ve=["onClick"],Oe={key:0},Ne={class:"border-t-2 border-gray-300 dark:border-gray-600"},Ue={class:"px-3 py-2 font-semibold text-center"},Ae={key:0,class:"px-6 py-3 text-xs text-rose-600"},Me={class:"flex items-center gap-5 justify-end"},Te=["disabled"],Re={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/40"},De={class:"w-[500px] max-w-[95vw] rounded-lg bg-white shadow"},Fe={class:"p-4"},Je={class:"mb-4"},ze={class:"text-lg font-semibold text-gray-900"},Ee={class:"mb-4"},He=["max"],Ke={key:0,class:"font-medium"},Ge={key:1},Le={class:"px-4 py-3 border-t flex justify-between"},We={class:"flex gap-2"},Qe=["disabled"],lt=Object.assign({layout:J},{__name:"Create",props:{orderNo:{type:String,required:!0},purchaseRequests:{type:Array,default:()=>[]},items:{type:Array,default:()=>[]},employees:{type:Array,default:()=>[]},branches:{type:Array,default:()=>[]},user:{type:Object,required:!0},isSuperadmin:{type:Boolean,required:!0}},setup(p){const I=[{label:"Penyimpanan"},{label:"Purchase Order",href:route("purchase-orders.index")},{label:"Buat Purchase Order"}],b=p,t=N({order_no:b.orderNo,ordered_at:new Date().toISOString().split("T")[0],vendor:"",request_id:"",note:"",items:[],employee_id:b.user?.employee?.id,branch_id:b.user?.employee?.branch_id||(b.branches.length>0?b.branches[0].id:null),amount_paid:0}),h=j(!1),u=j({amount_paid:0}),P=()=>{t.items.push({item_id:"",selectedItem:null,quantity_ordered:1,cost:0,note:"",unit:"",code:"",name:""})},S=s=>{t.items.splice(s,1),t.items=[...t.items]},$=(s,r)=>{r&&r.id?(t.items[s].item_id=r.id,t.items[s].selectedItem=r,t.items[s].unit=r.unit?.short_name||"",t.items[s].code=r.code||"",t.items[s].name=r.name||""):(t.items[s].item_id="",t.items[s].selectedItem=null,t.items[s].unit="",t.items[s].code="",t.items[s].name=""),t.items=[...t.items]},v=s=>{t.items[s]={...t.items[s]}},B=s=>{const r=t.items.filter((a,o)=>o!==s&&a.item_id).map(a=>a.item_id);return b.items.filter(a=>!r.includes(a.id))},m=U(()=>t.items.reduce((s,r)=>s+r.quantity_ordered*r.cost,0)),C=()=>{if(t.items.length===0){alert("Minimal harus ada satu item");return}if(!t.vendor||t.vendor.trim()===""){alert("Nama vendor harus diisi");return}u.value={amount_paid:0},h.value=!0},V=()=>{h.value=!1},O=()=>{if(u.value.amount_paid<0){alert("Jumlah pembayaran tidak boleh negatif");return}if(u.value.amount_paid>m.value){alert("Jumlah pembayaran tidak boleh melebihi total order");return}t.amount_paid=u.value.amount_paid||0,t.post(route("purchase-orders.store"),{onSuccess:()=>{h.value=!1}})},w=()=>{F.get(route("purchase-orders.index"))};A(()=>t.request_id,s=>{if(!s){t.items=[];return}const r=b.purchaseRequests.find(a=>a.id===s);r&&r.items&&(t.items=[],t.items=r.items.map(a=>{const o=b.items.find(d=>d.id===a.item_id);return{item_id:a.item_id,selectedItem:o||null,quantity_ordered:a.quantity_requested||1,cost:0,note:a.note||"",unit:o?.unit?.short_name||a.unit?.short_name||"",code:o?.code||a.code||"",name:o?.name||a.name||""}}))});const x=s=>{try{return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",maximumFractionDigits:0}).format(s||0)}catch{return s}};return(s,r)=>(c(),l(q,null,[g(n(M),{title:"Buat Purchase Order"}),e("div",G,[e("div",L,[g(z,{items:I})]),e("div",W,[e("div",Q,[r[1]||(r[1]=e("div",{class:"font-bold text-gray-700 md:text-xl dark:text-gray-300"}," Buat Purchase Order ",-1)),e("div",X,i(n(t).order_no),1)]),g(E,{form:n(t),purchaseRequests:p.purchaseRequests,items:p.items,user:p.user,isSuperadmin:p.isSuperadmin,employees:p.employees,branches:p.branches,onCancel:w},null,8,["form","purchaseRequests","items","user","isSuperadmin","employees","branches"])]),e("div",Y,[r[6]||(r[6]=e("div",{class:"flex items-center justify-between px-6 py-4"},[e("div",{class:"font-semibold text-gray-700 dark:text-gray-200"}," Daftar Item ")],-1)),e("div",Z,[e("table",ee,[r[5]||(r[5]=e("thead",null,[e("tr",null,[e("th",{class:"py-2.5 border-y border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800"},[e("div",{class:"flex items-center justify-center"},[e("p",{class:"flex flex-col items-center font-medium text-gray-500 whitespace-nowrap dark:text-gray-400"}," No. ")])]),e("th",{class:"py-3 border cursor-pointer border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800"},[e("div",{class:"flex items-center justify-center gap-2 px-3"},[e("p",{class:"font-medium text-gray-500 whitespace-nowrap dark:text-gray-400"}," Nama Barang ")])]),e("th",{class:"py-3 border border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800"},[e("div",{class:"flex cursor-pointer items-center justify-center gap-2 px-3"},[e("p",{class:"font-medium whitespace-nowrap text-gray-500 dark:text-gray-400"}," Kode Barang ")])]),e("th",{class:"py-3 border cursor-pointer border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800"},[e("div",{class:"flex items-center justify-center gap-2 px-3"},[e("p",{class:"font-medium text-gray-500 whitespace-nowrap dark:text-gray-400"}," Jumlah Pesan ")])]),e("th",{class:"py-3 border cursor-pointer border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800"},[e("div",{class:"flex items-center justify-center gap-2 px-3"},[e("p",{class:"font-medium text-gray-500 whitespace-nowrap dark:text-gray-400"}," Harga Satuan ")])]),e("th",{class:"py-3 border cursor-pointer border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800"},[e("div",{class:"flex items-center justify-center gap-2 px-3"},[e("p",{class:"font-medium text-gray-500 whitespace-nowrap dark:text-gray-400"}," Subtotal ")])]),e("th",{class:"py-3 border cursor-pointer border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800"},[e("div",{class:"flex items-center justify-center gap-2 px-3"},[e("p",{class:"font-medium text-gray-500 whitespace-nowrap dark:text-gray-400"}," Catatan ")])]),e("th",{class:"border-y border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800"},[e("div",{class:"flex items-center justify-center"},[e("p",{class:"font-medium text-gray-500 whitespace-nowrap dark:text-gray-400"}," Aksi ")])])])],-1)),e("tbody",null,[n(t).items.length===0?(c(),l("tr",te,[...r[2]||(r[2]=[e("td",{colspan:"8",class:"py-8 text-center text-gray-500"}," Belum ada item. Pilih Purchase Request atau tambah item secara manual. ",-1)])])):y("",!0),(c(!0),l(q,null,T(n(t).items,(a,o)=>(c(),l("tr",{key:o,class:"hover:bg-gray-100 cursor-pointer dark:hover:bg-gray-800"},[e("td",re,[e("div",ae,i(o+1)+". ",1)]),e("td",se,[g(K,{modelValue:a.selectedItem,"onUpdate:modelValue":[d=>a.selectedItem=d,d=>$(o,d)],items:B(o),label:"Pilih Item"},{item:R(({item:d})=>[p.isSuperadmin?(c(),l("div",oe,[e("span",de,i(d.name)+" ("+i(d.branch?.name||"-")+")",1),e("span",ne,i(d.code),1)])):(c(),l("div",ie,[e("span",le,i(d.name),1),e("span",ce,i(d.code),1)]))]),_:1},8,["modelValue","onUpdate:modelValue","items"]),n(t).errors[`items.${o}.item_id`]?(c(),l("div",ue,i(n(t).errors[`items.${o}.item_id`][0]),1)):y("",!0)]),e("td",me,[e("div",ye,[e("p",pe,i(a.code),1)])]),e("td",be,[e("div",ge,[_(e("input",{"onUpdate:modelValue":d=>a.quantity_ordered=d,onInput:d=>v(o),type:"number",min:"1",class:"w-24 rounded border-gray-300 dark:border-gray-700 dark:bg-gray-800 dark:text-white/90",required:""},null,40,he),[[f,a.quantity_ordered,void 0,{number:!0}]]),D(" "+i(a.unit),1)]),n(t).errors[`items.${o}.quantity_ordered`]?(c(),l("div",xe,i(n(t).errors[`items.${o}.quantity_ordered`]),1)):y("",!0)]),e("td",_e,[e("div",fe,[_(e("input",{"onUpdate:modelValue":d=>a.cost=d,onInput:d=>v(o),type:"number",min:"0",step:"0.01",class:"w-32 rounded border-gray-300 dark:border-gray-700 dark:bg-gray-800 dark:text-white/90"},null,40,ke),[[f,a.cost,void 0,{number:!0}]])]),n(t).errors[`items.${o}.cost`]?(c(),l("div",ve,i(n(t).errors[`items.${o}.cost`]),1)):y("",!0)]),e("td",we,[e("div",je,[e("p",qe,i(x(a.quantity_ordered*a.cost)),1)])]),e("td",Ie,[e("div",Pe,[_(e("input",{"onUpdate:modelValue":d=>a.note=d,type:"text",placeholder:"Masukkan catatan",class:"w-40 h-10 text-sm rounded placeholder:text-gray-600 border-gray-300 dark:border-gray-700 dark:bg-gray-800 dark:text-white/90"},null,8,Se),[[f,a.note]])]),n(t).errors[`items.${o}.note`]?(c(),l("div",$e,i(n(t).errors[`items.${o}.note`]),1)):y("",!0)]),e("td",Be,[e("div",Ce,[e("button",{onClick:d=>S(o),type:"button"},[g(H,{class:"text-red-500"})],8,Ve)])])]))),128))]),n(t).items.length>0?(c(),l("tfoot",Oe,[e("tr",Ne,[r[3]||(r[3]=e("td",{colspan:"5",class:"px-3 py-2 text-right font-semibold"},"Total:",-1)),e("td",Ue,i(x(m.value)),1),r[4]||(r[4]=e("td",{colspan:"2"},null,-1))])])):y("",!0)]),e("button",{type:"button",onClick:P,class:"m-4 px-3 py-2 text-white bg-green-500 hover:bg-green-600 rounded whitespace-nowrap"}," + Tambah Item ")]),n(t).errors.items?(c(),l("div",Ae,i(n(t).errors.items[0]),1)):y("",!0)]),e("div",Me,[e("button",{type:"button",onClick:w,class:"inline-flex items-center rounded border bg-gray-400 border-gray-300 px-5 py-2 text-sm text-white hover:text-gray-800 hover:bg-gray-300 dark:border-gray-700 dark:text-gray-300"}," Batal "),e("button",{onClick:C,disabled:n(t).processing||n(t).items.length===0,class:"inline-flex items-center rounded bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 disabled:opacity-60"},i(n(t).processing?"Menyimpan...":"Buat dengan Pembayaran"),9,Te)]),h.value?(c(),l("div",Re,[e("div",De,[r[10]||(r[10]=e("div",{class:"px-4 py-3 border-b"},[e("div",{class:"font-semibold"},"Konfirmasi Pembayaran (Opsional)")],-1)),e("div",Fe,[r[9]||(r[9]=e("div",{class:"text-sm text-gray-600 mb-4"}," Masukkan jumlah yang telah dibayar untuk Purchase Order ini. Anda juga dapat menyimpan tanpa pembayaran. ",-1)),e("div",Je,[r[7]||(r[7]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Total Order",-1)),e("div",ze,i(x(m.value)),1)]),e("div",Ee,[r[8]||(r[8]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Jumlah yang Dibayar (Opsional)",-1)),_(e("input",{"onUpdate:modelValue":r[0]||(r[0]=a=>u.value.amount_paid=a),type:"number",min:"0",max:m.value,step:"0.01",class:k(["w-full px-3 py-2 rounded border focus:ring-2 focus:ring-blue-500 focus:border-blue-500",u.value.amount_paid>m.value?"border-red-500 bg-red-50":"border-gray-300"]),placeholder:"Masukkan jumlah yang dibayar (kosongkan jika tidak ada pembayaran)"},null,10,He),[[f,u.value.amount_paid,void 0,{number:!0}]]),u.value.amount_paid>0?(c(),l("div",{key:0,class:k(["text-xs mt-1",u.value.amount_paid>m.value?"text-red-600":"text-gray-500"])},[u.value.amount_paid>m.value?(c(),l("span",Ke," Jumlah pembayaran melebihi total order! ")):(c(),l("span",Ge," Sisa: "+i(x(m.value-u.value.amount_paid)),1))],2)):y("",!0)])]),e("div",Le,[e("button",{onClick:V,class:"px-3 h-9 rounded border hover:bg-gray-50"},"Batal"),e("div",We,[e("button",{onClick:O,disabled:u.value.amount_paid>m.value,class:k(["px-3 h-9 rounded text-white hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",u.value.amount_paid>m.value?"bg-red-600":"bg-blue-600"])}," Simpan ",10,Qe)])])])])):y("",!0)])],64))}});export{lt as default};
