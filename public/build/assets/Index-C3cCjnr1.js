import{d as c,y as J,z as K,l as Y,H as D,e as n,o as r,b as w,a as t,g as k,D as H,E as m,G as I,J as v,F as d,i as p,t as b,f as F,n as z,c as f,w as W,L as Q}from"./app-CJkCV51W.js";import{_ as X}from"./AppLayout-BlEKf3Fz.js";import{_ as Z}from"./Breadcrumb-BJQpsGcc.js";import{_ as ee}from"./Modal-Ddbg9qvg.js";import ae from"./MonthlyStatusTab-DrWqcFSa.js";import le from"./LateTab-Crw8u9-5.js";import te from"./LeaveTab-Bj2Xlp5_.js";import oe from"./OvertimeTab-CJ6y6hLn.js";import re from"./SalaryTab-CpvA-0rk.js";import{u as ne}from"./useAuth-DvuTgkfF.js";import"./FlashMessage-D4C-FUm8.js";import"./LayoutShell-FWpWJLvi.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./LayoutShell.vue_vue_type_style_index_0_lang-CRqqKi3W.js";import"./Pagination-C2dOEo8X.js";import"./AvatarInitials-XMdLKKbn.js";import"./ConfirmModal-DAlWp-FQ.js";const se={class:"flex overflow-hidden flex-col gap-3 px-3 h-full"},ue={class:"flex justify-between items-center h-10"},ie={class:"flex gap-2 items-center"},de={class:"relative"},me={class:"px-4 py-3 bg-white rounded-lg border border-gray-200"},pe={class:"flex flex-wrap gap-2 items-center justify-between"},be={class:"flex flex-wrap gap-2 items-center flex-1"},ce={class:"w-auto min-w-[160px] max-w-[200px]"},ve=["value"],fe={class:"w-auto min-w-[160px] max-w-[200px]"},ye=["value"],ge={class:"w-auto min-w-[100px] max-w-[120px]"},xe=["value"],_e={class:"w-auto min-w-[100px] max-w-[120px]"},he=["value"],we={class:"flex overflow-hidden flex-col bg-white rounded-lg border border-gray-200"},ke={class:"px-2 sm:px-4 md:px-6 pt-4 border-b"},Se={class:"flex gap-4 items-center mb-3 text-sm"},$e=["onClick"],Ce={key:0},je={key:1},De={key:2},Fe={key:3},Oe={key:4},Ae={class:"p-4 border-b"},Ue={class:"space-y-4"},Ve=["value"],Be=["value"],Xe=Object.assign({layout:X},{__name:"Index",props:{tab:String,summary:Object,attendances:Object,leaveRows:Object,lateRows:Object,overtimeRows:Object,salaryRows:Object,filters:Object,branches:Array,departments:Array,employees:Array},setup(i){const{can:O}=ne(),A=[{label:"Absensi"},{label:"Rekaptulasi Absensi"}],s=i,U=[{value:"monthly-status",label:"Status Absensi Bulanan"},{value:"late",label:"Keterlambatan"},{value:"overtime",label:"Lembur"},{value:"leave",label:"Cuti"},{value:"salary",label:"Gaji dan Tunjangan"}],x=new Date,l=c({tab:s.tab||"monthly-status",q:s.filters?.q||"",branch_id:s.filters?.branch_id||"",department_id:s.filters?.department_id||"",employee_id:s.filters?.employee_id||"",date_from:s.filters?.date_from||"",date_to:s.filters?.date_to||"",year:s.filters?.year||x.getFullYear(),month:s.filters?.month||x.getMonth()+1}),y=c(s.departments||[]),S=[{value:1,label:"Jan"},{value:2,label:"Feb"},{value:3,label:"Mar"},{value:4,label:"Apr"},{value:5,label:"Mei"},{value:6,label:"Jun"},{value:7,label:"Jul"},{value:8,label:"Agu"},{value:9,label:"Sep"},{value:10,label:"Okt"},{value:11,label:"Nov"},{value:12,label:"Des"}],V=Array.from({length:6}).map((o,a)=>x.getFullYear()-3+a),_=c(!1),h=c(null),u=c({employee_id:"",bulan:"",file:null}),B=J(()=>{const o=[],a=l.value.year;for(let e=1;e<=12;e++){const j=`${a}-${String(e).padStart(2,"0")}`,L=S.find(N=>N.value===e)?.label||`Bulan ${e}`;o.push({value:j,label:`${L} ${a}`})}return o});let $=null;K(()=>({...l.value}),()=>{clearTimeout($),$=setTimeout(()=>g(),300)},{deep:!0}),Y(()=>{(!s.attendances||!s.attendances.data||s.attendances.data.length===0)&&g()}),c(!1);function M(){l.value.department_id="",R()}function R(){l.value.branch_id?Q.get(route("attendance-recap.departments"),{params:{branch_id:l.value.branch_id}}).then(o=>{y.value=o.data.departments||[]}).catch(o=>{console.error("Error fetching departments:",o),y.value=[]}):y.value=s.departments||[]}function T(o){l.value.tab!==o&&(l.value.tab=o,g())}function E(){_.value=!0,u.value={employee_id:"",bulan:"",file:null},h.value&&(h.value.value="")}function C(){_.value=!1}function q(o){const a=o.target.files[0];if(a){if(a.type!=="application/pdf"){alert("Hanya file PDF yang diperbolehkan"),o.target.value="";return}u.value.file=a}}function P(){if(!u.value.employee_id||!u.value.bulan||!u.value.file){alert("Semua field harus diisi");return}const o=new FormData;o.append("employee_id",u.value.employee_id),o.append("bulan",u.value.bulan),o.append("file",u.value.file),D.post(route("salary-slips.store"),o,{onSuccess:()=>{C(),g()},onError:a=>{console.error("Error saving salary slip:",a),alert("Gagal menyimpan salary slip")}})}function g(){D.get(route("attendance-recap.index"),{...l.value},{preserveScroll:!0,preserveState:!0,replace:!0})}function G(){const o=new URLSearchParams({tab:l.value.tab,year:l.value.year,month:l.value.month});l.value.department_id&&o.append("department_id",l.value.department_id),l.value.employee_id&&o.append("employee_id",l.value.employee_id),l.value.branch_id&&o.append("branch_id",l.value.branch_id),l.value.q&&o.append("q",l.value.q);const a=route("attendance-recap.export")+"?"+o.toString();window.open(a,"_blank")}return(o,a)=>(r(),n(d,null,[w(k(H),{title:"Rekaptulasi Absensi"}),t("div",se,[t("div",ue,[w(Z,{items:A}),t("div",ie,[t("div",de,[m(t("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>l.value.q=e),type:"text",placeholder:"Cari...",class:"py-2.5 pr-8 pl-3 w-64 h-10 text-sm text-gray-800 bg-transparent rounded-lg border border-gray-200 focus:border-blue-300 focus:outline-hidden focus:ring-2 focus:ring-blue-500/20"},null,512),[[I,l.value.q]]),a[7]||(a[7]=t("span",{class:"absolute right-2 top-1/2 text-gray-400 -translate-y-1/2"},"ðŸ”",-1))])])]),t("div",me,[t("div",pe,[t("div",be,[t("div",ce,[m(t("select",{"onUpdate:modelValue":a[1]||(a[1]=e=>l.value.branch_id=e),class:"w-full px-3 h-9 text-sm rounded-lg border border-gray-300 focus:border-blue-400 focus:ring-2 focus:ring-blue-100",onChange:M},[a[8]||(a[8]=t("option",{value:""},"Semua Cabang",-1)),(r(!0),n(d,null,p(i.branches,e=>(r(),n("option",{key:e.id,value:e.id},b(e.name),9,ve))),128))],544),[[v,l.value.branch_id]])]),t("div",fe,[m(t("select",{"onUpdate:modelValue":a[2]||(a[2]=e=>l.value.department_id=e),class:"w-full px-3 h-9 text-sm rounded-lg border border-gray-300 focus:border-blue-400 focus:ring-2 focus:ring-blue-100"},[a[9]||(a[9]=t("option",{value:""},"Semua Departemen",-1)),(r(!0),n(d,null,p(y.value,e=>(r(),n("option",{key:e.id,value:e.id},b(e.name),9,ye))),128))],512),[[v,l.value.department_id]])]),t("div",ge,[m(t("select",{"onUpdate:modelValue":a[3]||(a[3]=e=>l.value.year=e),class:"w-full px-3 h-9 text-sm rounded-lg border border-gray-300 focus:border-blue-400 focus:ring-2 focus:ring-blue-100"},[(r(!0),n(d,null,p(k(V),e=>(r(),n("option",{key:e,value:e},b(e),9,xe))),128))],512),[[v,l.value.year]])]),t("div",_e,[m(t("select",{"onUpdate:modelValue":a[4]||(a[4]=e=>l.value.month=e),class:"w-full px-3 h-9 text-sm rounded-lg border border-gray-300 focus:border-blue-400 focus:ring-2 focus:ring-blue-100"},[(r(),n(d,null,p(S,e=>t("option",{key:e.value,value:e.value},b(e.label),9,he)),64))],512),[[v,l.value.month]])])]),t("div",{class:"w-auto min-w-[140px]"},[t("button",{type:"button",onClick:G,class:"w-full px-4 h-9 text-sm font-medium text-emerald-700 bg-emerald-50 rounded-lg border border-emerald-300 hover:bg-emerald-100 transition-colors"}," Export Excel ")])])]),t("div",we,[t("div",ke,[t("div",Se,[(r(),n(d,null,p(U,e=>t("button",{key:e.value,class:z(["px-3 py-2 rounded-t",l.value.tab===e.value?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-800"]),onClick:j=>T(e.value)},b(e.label),11,$e)),64))])]),l.value.tab==="monthly-status"?(r(),n("div",Ce,[(r(),f(ae,{rows:i.attendances,year:l.value.year,month:l.value.month,key:`monthly-${l.value.tab}`},null,8,["rows","year","month"]))])):l.value.tab==="late"?(r(),n("div",je,[(r(),f(le,{rows:i.attendances,key:`late-${l.value.tab}`},null,8,["rows"]))])):l.value.tab==="leave"?(r(),n("div",De,[(r(),f(te,{rows:i.leaveRows,key:`leave-${l.value.tab}`},null,8,["rows"]))])):l.value.tab==="overtime"?(r(),n("div",Fe,[(r(),f(oe,{rows:i.attendances,key:`overtime-${l.value.tab}`},null,8,["rows"]))])):l.value.tab==="salary"?(r(),n("div",Oe,[t("div",Ae,[k(O)("attendance_recap.create_salary_slip")?(r(),n("button",{key:0,onClick:E,class:"px-4 py-2 text-sm text-white bg-blue-600 rounded-lg hover:bg-blue-700"}," + Tambah Slip Gaji ")):F("",!0)]),(r(),f(re,{rows:i.salaryRows,year:l.value.year,key:`salary-${l.value.tab}`},null,8,["rows","year"]))])):F("",!0),w(ee,{show:_.value,title:"Tambah Slip Gaji",confirmText:"Simpan",maxWidth:"md",onClose:C,onConfirm:P},{default:W(()=>[t("div",Ue,[t("div",null,[a[11]||(a[11]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Pilih Karyawan ",-1)),m(t("select",{"onUpdate:modelValue":a[5]||(a[5]=e=>u.value.employee_id=e),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[a[10]||(a[10]=t("option",{value:""},"Pilih Karyawan",-1)),(r(!0),n(d,null,p(i.employees,e=>(r(),n("option",{key:e.id,value:e.id},b(e.name),9,Ve))),128))],512),[[v,u.value.employee_id]])]),t("div",null,[a[13]||(a[13]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Bulan ",-1)),m(t("select",{"onUpdate:modelValue":a[6]||(a[6]=e=>u.value.bulan=e),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[a[12]||(a[12]=t("option",{value:""},"Pilih Bulan",-1)),(r(!0),n(d,null,p(B.value,e=>(r(),n("option",{key:e.value,value:e.value},b(e.label),9,Be))),128))],512),[[v,u.value.bulan]])]),t("div",null,[a[14]||(a[14]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Upload File PDF ",-1)),t("input",{ref_key:"fileInput",ref:h,type:"file",accept:".pdf",onChange:q,class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,544),a[15]||(a[15]=t("p",{class:"text-xs text-gray-500 mt-1"}," Hanya file PDF yang diperbolehkan ",-1))])])]),_:1},8,["show"])])])],64))}});export{Xe as default};
