import{d as v,y as L,x as b,z as k,u as R,l as F,e as l,o as u,b as f,a as e,g as d,D as W,f as g,F as q,i as A,t as c,w as E,n as I,E as H,h as D,G as J,L as G,H as K}from"./app-CJkCV51W.js";import{_ as Q}from"./AppLayout-BlEKf3Fz.js";import{_ as X}from"./Breadcrumb-BJQpsGcc.js";import Y from"./Form-CAWNW5uF.js";import{T as Z}from"./TrashIcon-DSAHmBPH.js";import{_ as ee}from"./SelectBarang-CRvJrPbK.js";import{v as y}from"./v4-BKrj-4V8.js";import"./FlashMessage-D4C-FUm8.js";import"./LayoutShell-FWpWJLvi.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useAuth-DvuTgkfF.js";import"./LayoutShell.vue_vue_type_style_index_0_lang-CRqqKi3W.js";import"./SelectPemakaian-bo5sz744.js";const te={class:"flex overflow-hidden flex-col gap-3 px-3 h-full"},re={class:"flex justify-between items-center h-10"},se={class:"space-y-5 overflow-hidden rounded-lg border border-gray-200 bg-white p-6 dark:border-gray-700 dark:bg-white/[0.03]"},ae={key:0,class:"mb-4 p-4 bg-red-50 border border-red-200 rounded-md dark:bg-red-900/20 dark:border-red-800"},oe={class:"flex"},de={class:"ml-3"},ie={class:"mt-2 text-sm text-red-700 dark:text-red-300"},ne={class:"list-disc list-inside space-y-1"},le={key:0},ue={key:1},ce={class:"overflow-hidden rounded-lg border border-gray-200 bg-white dark:border-gray-700 dark:bg-white/[0.03]"},me={class:"overflow-auto","data-simplebar":""},pe={class:"min-w-full text-sm"},ge={class:"w-4 py-2.5 border-y border-gray-200 dark:border-gray-600"},ye={class:"flex items-center whitespace-nowrap justify-center"},be={class:"px-3 py-2.5 border border-gray-200 dark:border-gray-600"},fe={class:"flex flex-col py-1"},he={class:"flex items-center justify-between"},xe={class:"font-medium text-gray-900 dark:text-gray-100 text-sm"},_e={key:0,class:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full"},ve={class:"text-xs text-gray-500 dark:text-gray-400"},ke={key:0,class:"text-xs text-rose-600 mt-1 flex items-center gap-1"},qe={class:"py-2.5 border border-gray-200 dark:border-gray-600"},we={class:"flex items-center px-3 whitespace-nowrap justify-center"},je={class:"text-gray-500 dark:text-gray-400"},Ce={class:"py-2.5 border border-gray-200 dark:border-gray-600"},Be={class:"flex items-center px-3 whitespace-nowrap justify-center"},$e={class:"text-gray-500 dark:text-gray-400"},ze={class:"py-2.5 border border-gray-200 dark:border-gray-600"},Ae={class:"flex items-center gap-3 ps-6 whitespace-nowrap"},Ee=["onUpdate:modelValue"],Ie={key:0,class:"text-xs text-rose-600 mt-1 flex items-center gap-1"},De={class:"py-2.5 border-y border-gray-200 dark:border-gray-600"},Me={class:"flex justify-center whitespace-nowrap px-4 gap-3"},Te=["onClick"],Ve={key:0,class:"px-6 py-3 bg-red-50 border-t border-red-200 dark:bg-red-900/20 dark:border-red-800"},Se={class:"flex items-center gap-2 text-sm text-rose-600 dark:text-rose-400"},Ue={key:0,class:"mb-4 p-4 bg-green-50 border border-green-200 rounded-md dark:bg-green-900/20 dark:border-green-800"},Ne={class:"flex"},Oe={class:"ml-3"},Pe={class:"text-sm font-medium text-green-800 dark:text-green-200"},Le={class:"flex items-center gap-5 justify-end"},Re=["disabled"],Fe={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24"},at=Object.assign({layout:Q},{__name:"Edit",props:{mr:Object,items:{type:Array,default:()=>[]},allItems:{type:Array,default:()=>[]},departments:{type:Array,required:!0},employees:{type:Array,required:!0},user:{type:Object,required:!0},statusOptions:{type:Array,default:()=>[]}},setup(h){const M=[{label:"Penyimpanan"},{label:"Permintaan Barang",href:route("material-requests.index")},{label:"Ubah Permintaan"}],m=h,p=v(m.allItems.map(t=>({id:t.id,name:t.name,code:t.code,stock:t.stock,unit:t.unit})));console.log("Initial options from props:",p.value);const w=async t=>{if(!t){p.value=[];return}try{const r=await G.get(route("material-requests.items.by-department"),{params:{department_id:t},headers:{Accept:"application/json","Content-Type":"application/json"}});r.data&&r.data.items?(p.value=r.data.items.map(o=>({id:o.id,name:o.name,code:o.code,stock:o.stock,unit:o.unit})),console.log("Fetched items:",p.value)):p.value=[]}catch(r){console.error("Error fetching items by department:",r),p.value=[]}},T=t=>{j.value;const r=i.value.map((o,a)=>a!==t&&o.item_id?.id?o.item_id.id:null).filter(o=>o!==null);return p.value.filter(o=>!r.includes(o.id))};L(()=>i.value.map(t=>t.item_id?.id).filter(t=>t!==null));const j=v(0),x=()=>{j.value++},V=(t,r)=>i.value.some((o,a)=>a!==r&&o.item_id?.id===t);function S(t){const r={id:Date.now(),name:t,code:"-",stock:0};return p.value.push(r),r}const i=v(m.items?.map(t=>{const r=p.value.find(o=>o.id===t.item_id);return b({uid:y(),item_id:r||null,request:t.qty,code:t.item_code||"",name:t.item_name||"",stock:r?.stock||0,unit:r?.unit||null,note:t.note||""})})||[b({uid:y(),item_id:null,request:1,code:"",name:"",stock:""})]),U=()=>{const t=b({uid:y(),item_id:null,request:1,code:"",name:"",stock:"",unit:null,note:""});i.value.push(t),_(t),x()},_=t=>{k(()=>t.item_id,r=>{console.log("bindWatcher - newVal:",r),console.log("bindWatcher - row before update:",{code:t.code,name:t.name,stock:t.stock}),r?(t.code=r.code,t.name=r.name,t.stock=r.stock||0,t.unit=r.unit,console.log("bindWatcher - row after update:",{code:t.code,name:t.name,stock:t.stock})):(t.code="",t.name="",t.stock="",t.unit={})},{immediate:!0})};i.value.forEach(_),k(i,()=>{x()},{deep:!0});const C=t=>{console.log("Department changed to:",t),w(t),i.value=[b({uid:y(),item_id:null,request:1,code:"",name:"",stock:""})],_(i.value[0]),s.requests=[{uid:y(),item_id:null,request:1,note:""}],x()},N=t=>{i.value.splice(t,1),x()};m.user?.roles?.[0]?.name;const s=R({request_no:m.mr?.request_no||"",requested_at:m.mr?.requested_at||new Date().toISOString().slice(0,10),department_id:m.mr?.department_id,employee_id:m.mr?.employee_id,requirement:m.mr?.requirement||"",requests:m.items?.map(t=>({uid:y(),item_id:t.item_id,request:t.qty,note:t.note||""}))||[{uid:y(),item_id:null,request:1,note:""}]});k(()=>s.department_id,(t,r)=>{t!==r&&C(t)}),F(()=>{s.department_id&&w(s.department_id)});function O(){if(s.clearErrors(),!i.value||i.value.length===0){s.setError("requests","Minimal harus ada satu item permintaan");return}const t=i.value.map(a=>a.item_id?.id).filter(Boolean);if(t.filter((a,n)=>t.indexOf(a)!==n).length>0){s.setError("requests","Tidak boleh ada item yang duplikat");return}i.value.some((a,n)=>!a.item_id||!a.item_id.id?(s.setError(`requests.${n}.item_id`,"Pilih barang yang diminta"),!0):!a.request||a.request<=0?(s.setError(`requests.${n}.request`,"Jumlah permintaan harus lebih dari 0"),!0):!1)||(s.requests=i.value.map((a,n)=>({uid:a.uid,item_id:a.item_id?.id??null,request:a.request,note:a.note??null})),s.put(route("material-requests.update",m.mr?.id)))}const B=b({}),$=b({});m.items.forEach(t=>{B[t.id]=0,$[t.id]=""});function P(){s.transform(t=>({...t,items:m.items.map(r=>({item_id:r.id,qty:Number(B[r.id]||0),notes:$[r.id]||""})).filter(r=>r.qty>0)})).post(route("material-requests.store"),{onFinish:()=>s.transform(t=>t)})}function z(){K.get(route("material-requests.index"))}return s.errors,(t,r)=>(u(),l(q,null,[f(d(W),{title:"Ubah Permintaan Barang"}),e("div",te,[e("div",re,[f(X,{items:M})]),e("div",se,[r[2]||(r[2]=e("h1",{class:"text-lg font-semibold text-gray-700 dark:text-gray-200"}," Ubah Permintaan Barang ",-1)),d(s).errors&&Object.keys(d(s).errors).length>0?(u(),l("div",ae,[e("div",oe,[r[1]||(r[1]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})])],-1)),e("div",de,[r[0]||(r[0]=e("h3",{class:"text-sm font-medium text-red-800 dark:text-red-200"}," Terjadi kesalahan validasi ",-1)),e("div",ie,[e("ul",ne,[(u(!0),l(q,null,A(d(s).errors,(o,a)=>(u(),l("li",{key:a},[typeof o=="string"?(u(),l("span",le,c(o),1)):Array.isArray(o)?(u(),l("span",ue,c(o[0]),1)):g("",!0)]))),128))])])])])])):g("",!0),f(Y,{form:d(s),departments:h.departments,user:h.user,employees:h.employees,isEdit:!0,onSubmit:P,onCancel:z,onDepartmentChanged:C},null,8,["form","departments","user","employees"])]),e("div",ce,[r[8]||(r[8]=e("div",{class:"flex items-center justify-between px-6 py-4"},[e("div",{class:"font-semibold text-gray-700 dark:text-gray-200"}," Daftar Item ")],-1)),e("div",me,[e("table",pe,[r[6]||(r[6]=e("thead",null,[e("tr",null,[e("th",{class:"py-2.5 border-y border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800"},[e("div",{class:"flex items-center justify-center"},[e("p",{class:"flex flex-col items-center font-medium text-gray-500 whitespace-nowrap dark:text-gray-400"}," No. ")])]),e("th",{class:"py-3 border cursor-pointer border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800"},[e("div",{class:"flex items-center justify-center gap-2 px-3"},[e("p",{class:"font-medium text-gray-500 whitespace-nowrap dark:text-gray-400"}," Nama Barang ")])]),e("th",{class:"py-3 border border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800"},[e("div",{class:"flex cursor-pointer items-center justify-center gap-2 px-3"},[e("p",{class:"font-medium whitespace-nowrap text-gray-500 dark:text-gray-400"}," Kode Barang ")])]),e("th",{class:"py-3 border cursor-pointer border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800"},[e("div",{class:"flex items-center justify-center gap-2 px-3"},[e("p",{class:"font-medium text-gray-500 whitespace-nowrap dark:text-gray-400"}," Stok Tersedia ")])]),e("th",{class:"py-3 border cursor-pointer border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800"},[e("div",{class:"flex items-center justify-center gap-2 px-3"},[e("p",{class:"font-medium text-gray-500 whitespace-nowrap dark:text-gray-400"}," Jumlah Permintaan ")])]),e("th",{class:"border-y border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800"},[e("div",{class:"flex items-center justify-center"},[e("p",{class:"font-medium text-gray-500 whitespace-nowrap dark:text-gray-400"}," Aksi ")])])])],-1)),e("tbody",null,[(u(!0),l(q,null,A(i.value,(o,a)=>(u(),l("tr",{key:o.uid,class:"hover:bg-gray-100 cursor-pointer dark:hover:bg-gray-800"},[e("td",ge,[e("div",ye,c(a+1)+". ",1)]),e("td",be,[f(ee,{modelValue:o.item_id,"onUpdate:modelValue":n=>o.item_id=n,items:T(a),taggable:!0,"search-key":"name","label-key":"name",label:"Cari Barang",onTag:S,class:I(["w-full",d(s).errors[`requests.${a}.item_id`]?"border-red-300 focus:border-red-500 focus:ring-red-500":"border-gray-300 focus:border-blue-500 focus:ring-blue-500"])},{item:E(({item:n})=>[e("div",fe,[e("div",he,[e("span",xe,c(n.name),1),V(n.id,a)?(u(),l("span",_e," Dipilih ")):g("",!0)]),e("span",ve,c(n.code||"-"),1)])]),"no-options":E(()=>[...r[3]||(r[3]=[e("div",{class:"text-sm text-gray-500 p-2"}," Semua barang telah dipilih di baris lain ",-1)])]),_:2},1032,["modelValue","onUpdate:modelValue","items","class"]),d(s).errors[`requests.${a}.item_id`]?(u(),l("div",ke,[r[4]||(r[4]=e("svg",{class:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)),e("span",null,c(Array.isArray(d(s).errors[`requests.${a}.item_id`])?d(s).errors[`requests.${a}.item_id`][0]:d(s).errors[`requests.${a}.item_id`]),1)])):g("",!0)]),e("td",qe,[e("div",we,[e("p",je,c(o.code),1)])]),e("td",Ce,[e("div",Be,[e("p",$e,c(o.stock)+" "+c(o.unit?.short_name),1)])]),e("td",ze,[e("div",Ae,[H(e("input",{"onUpdate:modelValue":n=>o.request=n,type:"number",min:"0",class:I(["w-24 rounded dark:bg-gray-800 dark:text-white/90",d(s).errors[`requests.${a}.request`]?"border-red-300 focus:border-red-500 focus:ring-red-500":"border-gray-300 focus:border-blue-500 focus:ring-blue-500"])},null,10,Ee),[[J,o.request]]),D(" "+c(o.unit?.short_name),1)]),d(s).errors[`requests.${a}.request`]?(u(),l("div",Ie,[r[5]||(r[5]=e("svg",{class:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)),e("span",null,c(Array.isArray(d(s).errors[`requests.${a}.request`])?d(s).errors[`requests.${a}.request`][0]:d(s).errors[`requests.${a}.request`]),1)])):g("",!0)]),e("td",De,[e("div",Me,[e("button",{onClick:n=>N(a)},[f(Z,{class:"text-red-500"})],8,Te)])])]))),128)),e("button",{type:"button",onClick:U,class:"m-4 px-3 py-2 text-white bg-green-500 hover:bg-green-600 rounded whitespace-nowrap"}," + Tambah Request ")])])]),d(s).errors.requests?(u(),l("div",Ve,[e("div",Se,[r[7]||(r[7]=e("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)),e("span",null,c(Array.isArray(d(s).errors.requests)?d(s).errors.requests[0]:d(s).errors.requests),1)])])):g("",!0)]),t.$page.props.flash?.success?(u(),l("div",Ue,[e("div",Ne,[r[9]||(r[9]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-green-400",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})])],-1)),e("div",Oe,[e("p",Pe,c(t.$page.props.flash.success),1)])])])):g("",!0),e("div",Le,[e("button",{type:"button",onClick:z,class:"inline-flex items-center rounded border bg-gray-400 border-gray-300 px-5 py-2 text-sm text-white hover:text-gray-800 hover:bg-gray-300 dark:border-gray-700 dark:text-gray-300"}," Batal "),e("button",{onClick:O,disabled:d(s).processing,class:"inline-flex items-center rounded bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 disabled:opacity-60 disabled:cursor-not-allowed"},[d(s).processing?(u(),l("svg",Fe,[...r[10]||(r[10]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):g("",!0),D(" "+c(d(s).processing?"Menyimpan...":"Simpan Perubahan"),1)],8,Re)])])],64))}});export{at as default};
