import{d as x,x as C,z as h,u as P,e as l,o as c,b as p,a as e,g as i,D,f as m,F as b,i as k,t as d,w as N,n as _,E as z,h as j,G as q,H as O}from"./app-CJkCV51W.js";import{_ as U}from"./AppLayout-BlEKf3Fz.js";import{_ as J}from"./Breadcrumb-BJQpsGcc.js";import K from"./Form-DxRrVR7a.js";import{T as F}from"./TrashIcon-DSAHmBPH.js";import{_ as H}from"./SelectBarang-CRvJrPbK.js";import{v}from"./v4-BKrj-4V8.js";import"./FlashMessage-D4C-FUm8.js";import"./LayoutShell-FWpWJLvi.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useAuth-DvuTgkfF.js";import"./LayoutShell.vue_vue_type_style_index_0_lang-CRqqKi3W.js";import"./SelectPemakaian-bo5sz744.js";const G={class:"flex overflow-hidden flex-col gap-3 px-3 h-full"},Q={class:"flex justify-between items-center h-10"},R={class:"space-y-5 overflow-hidden rounded-lg border border-gray-200 bg-white p-6 dark:border-gray-700 dark:bg-white/[0.03]"},Y={key:0,class:"mb-4 p-4 bg-red-50 border border-red-200 rounded-md dark:bg-red-900/20 dark:border-red-800"},W={class:"flex"},X={class:"ml-3"},Z={class:"mt-2 text-sm text-red-700 dark:text-red-300"},ee={class:"list-disc list-inside space-y-1"},te={key:0},re={key:1},se={class:"overflow-hidden rounded-lg border border-gray-200 bg-white dark:border-gray-700 dark:bg-white/[0.03]"},ae={class:"overflow-auto","data-simplebar":""},oe={class:"min-w-full text-sm"},ie={class:"w-4 py-2.5 border-y border-gray-200 dark:border-gray-600"},ne={class:"flex items-center whitespace-nowrap justify-center"},de={class:"px-5 py-2.5 border border-gray-200 dark:border-gray-600"},le={class:"flex flex-col py-1"},ce={class:"font-medium text-gray-900 dark:text-gray-100 text-sm"},ue={class:"text-xs text-gray-500 dark:text-gray-400"},me={key:0,class:"text-xs text-rose-600 mt-1 flex items-center gap-1"},ge={class:"py-2.5 border border-gray-200 dark:border-gray-600"},ye={class:"flex items-center px-3 whitespace-nowrap justify-center"},pe={class:"text-gray-500 dark:text-gray-400"},be={class:"py-2.5 border border-gray-200 dark:border-gray-600"},fe={class:"flex items-center px-3 whitespace-nowrap justify-center"},xe={class:"text-gray-500 dark:text-gray-400"},he={class:"py-2.5 border border-gray-200 dark:border-gray-600"},ke={class:"flex items-center gap-3 ps-6 whitespace-nowrap"},_e=["onUpdate:modelValue"],ve={key:0,class:"text-xs text-rose-600 mt-1 flex items-center gap-1"},we={key:1,class:"text-xs text-rose-600 mt-1 flex items-center gap-1"},$e={class:"py-2.5 border border-gray-200 dark:border-gray-600"},Be={class:"flex items-center whitespace-nowrap justify-center"},Ce=["onUpdate:modelValue"],ze={key:0,class:"text-xs text-rose-600 mt-1 flex items-center gap-1"},je={class:"py-2.5 border-y border-gray-200 dark:border-gray-600"},qe={class:"flex justify-center whitespace-nowrap px-4 gap-3"},Ae=["onClick"],Ie={key:0,class:"px-6 py-3 bg-red-50 border-t border-red-200 dark:bg-red-900/20 dark:border-red-800"},Me={class:"flex items-center gap-2 text-sm text-rose-600 dark:text-rose-400"},Ee={key:0,class:"mb-4 p-4 bg-green-50 border border-green-200 rounded-md dark:bg-green-900/20 dark:border-green-800"},Te={class:"flex"},Se={class:"ml-3"},Ve={class:"text-sm font-medium text-green-800 dark:text-green-200"},Le={class:"flex items-center gap-5 justify-end"},Pe={key:1,class:"fixed inset-0 z-50 overflow-y-auto mt-12","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},De={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},Ne={class:"inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},Oe={class:"bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},Ue={class:"sm:flex sm:items-start"},Je={class:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left"},Ke={class:"mt-2"},Fe={class:"mt-4 p-3 bg-gray-50 dark:bg-gray-700 rounded-md"},He={class:"text-sm text-gray-600 dark:text-gray-300 space-y-1"},Ge={class:"bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},Qe=["disabled"],Re={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24"},lt=Object.assign({layout:U},{__name:"Create",props:{user:Object,branches:{type:Array,required:!0},employees:{type:Array,required:!0},items:{type:Array,default:()=>[]},roles:{type:String,default:()=>""},sortBy:String,sortDirection:String},setup(g){const A=[{label:"Penyimpanan"},{label:"Pemindahan Barang",href:route("good-transfers.index")},{label:"Buat Pemindahan"}],f=g,w=x(f.items.map(r=>({id:r.id,name:r.name,code:r.code,stock:r.stock,unit:r.unit,branch_id:r.branch_id}))),y=x(!1),I=r=>{const t=u.value.map((s,n)=>n!==r?s.item_id?.id:null).filter(Boolean),o=a.from_branch_id;return w.value.filter(s=>{const n=!t.includes(s.id),L=o?s.branch_id===o:!0;return n&&L})},$=r=>r.quantity_transferred>r.stock;function M(r){const t={id:Date.now(),name:r,code:"-",stock:0,unit:null,branch_id:a.from_branch_id??null};return w.value.push(t),t}const u=x([C({uid:v(),item_id:null,quantity_transferred:1,code:"",name:"",stock:0,unit:null,note:""})]),E=()=>{const r=C({uid:v(),item_id:null,quantity_transferred:1,code:"",name:"",stock:0,unit:null,note:""});h(()=>r.item_id,t=>{t?(r.code=t.code,r.name=t.name,r.stock=t.stock?.last_stock||0,r.unit=t.unit):(r.code="",r.name="",r.stock=0,r.unit=null)}),u.value.push(r)};u.value.forEach(r=>{h(()=>r.item_id,t=>{t?(r.code=t.code,r.name=t.name,r.stock=t.stock?.last_stock||0,r.unit=t.unit):(r.code="",r.name="",r.stock=0,r.unit=null)})});const T=r=>{u.value.splice(r,1)},a=P({from_branch_id:f.user?.employee?.branch?.id??null,to_branch_id:null,employee_id:f.user?.employee?.id??null,transferred_at:new Date().toISOString().slice(0,10),purpose:"",items:[{uid:v(),item_id:null,quantity_transferred:1,note:""}]});h(()=>a.from_branch_id,()=>{u.value.forEach(r=>{r.item_id=null,r.code="",r.name="",r.stock=0,r.unit=null})});function S(){if(a.clearErrors(),!u.value||u.value.length===0){a.setError("items","Minimal harus ada satu item pemindahan");return}const r=u.value.map(s=>s.item_id?.id).filter(Boolean);if(r.filter((s,n)=>r.indexOf(s)!==n).length>0){a.setError("items","Tidak boleh ada item yang duplikat");return}u.value.some((s,n)=>!s.item_id||!s.item_id.id?(a.setError(`items.${n}.item_id`,"Pilih barang yang akan dipindahkan"),!0):!s.quantity_transferred||s.quantity_transferred<=0?(a.setError(`items.${n}.quantity_transferred`,"Jumlah pengiriman harus lebih dari 0"),!0):s.quantity_transferred>s.stock?(a.setError(`items.${n}.quantity_transferred`,`Jumlah pengiriman tidak boleh melebihi stok tersedia (${s.stock} ${s.unit?.short_name||""})`),!0):s.note&&s.note.length>225?(a.setError(`items.${n}.note`,"Catatan tidak boleh lebih dari 225 karakter"),!0):!1)||(a.items=u.value.map(s=>({uid:s.uid,item_id:s.item_id?.id??null,quantity_transferred:s.quantity_transferred,note:s.note??null})),a.post(route("good-transfers.store")))}function V(){y.value=!1,S()}function B(){O.get(route("good-transfers.index"))}return(r,t)=>(c(),l(b,null,[p(i(D),{title:"Tambah Permintaan Barang"}),e("div",G,[e("div",Q,[p(J,{items:A})]),e("div",R,[t[5]||(t[5]=e("h1",{class:"text-lg font-semibold text-gray-700 dark:text-gray-200"}," Buat Pemindahan Barang ",-1)),i(a).errors&&Object.keys(i(a).errors).length>0?(c(),l("div",Y,[e("div",W,[t[4]||(t[4]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})])],-1)),e("div",X,[t[3]||(t[3]=e("h3",{class:"text-sm font-medium text-red-800 dark:text-red-200"}," Terjadi kesalahan validasi ",-1)),e("div",Z,[e("ul",ee,[(c(!0),l(b,null,k(i(a).errors,(o,s)=>(c(),l("li",{key:s},[typeof o=="string"?(c(),l("span",te,d(o),1)):Array.isArray(o)?(c(),l("span",re,d(o[0]),1)):m("",!0)]))),128))])])])])])):m("",!0),p(K,{form:i(a),branches:g.branches,employees:g.employees,user:g.user,roles:g.roles,onCancel:B},null,8,["form","branches","employees","user","roles"])]),e("div",se,[t[12]||(t[12]=e("div",{class:"flex items-center justify-between px-6 py-4"},[e("div",{class:"font-semibold text-gray-700 dark:text-gray-200"}," Daftar Item ")],-1)),e("div",ae,[e("table",oe,[t[10]||(t[10]=e("thead",null,[e("tr",null,[e("th",{class:"py-2.5 border-y border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800"},[e("div",{class:"flex items-center justify-center"},[e("p",{class:"flex flex-col items-center font-medium text-gray-500 whitespace-nowrap dark:text-gray-400"}," No. ")])]),e("th",{class:"py-3 border cursor-pointer border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800"},[e("div",{class:"flex items-center justify-center gap-2 px-3"},[e("p",{class:"font-medium text-gray-500 whitespace-nowrap dark:text-gray-400"}," Nama Barang ")])]),e("th",{class:"py-3 border border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800"},[e("div",{class:"flex cursor-pointer items-center justify-center gap-2 px-3"},[e("p",{class:"font-medium whitespace-nowrap text-gray-500 dark:text-gray-400"}," Kode Barang ")])]),e("th",{class:"py-3 border cursor-pointer border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800"},[e("div",{class:"flex items-center justify-center gap-2 px-3"},[e("p",{class:"font-medium text-gray-500 whitespace-nowrap dark:text-gray-400"}," Stok Tersedia ")])]),e("th",{class:"py-3 border cursor-pointer border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800"},[e("div",{class:"flex items-center justify-center gap-2 px-3"},[e("p",{class:"font-medium text-gray-500 whitespace-nowrap dark:text-gray-400"}," Jumlah Pengiriman ")])]),e("th",{class:"py-3 border cursor-pointer border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800"},[e("div",{class:"flex items-center justify-center gap-2 px-3"},[e("p",{class:"font-medium text-gray-500 whitespace-nowrap dark:text-gray-400"}," Catatan ")])]),e("th",{class:"border-y border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800"},[e("div",{class:"flex items-center justify-center"},[e("p",{class:"font-medium text-gray-500 whitespace-nowrap dark:text-gray-400"}," Aksi ")])])])],-1)),e("tbody",null,[(c(!0),l(b,null,k(u.value,(o,s)=>(c(),l("tr",{key:o.uid,class:"hover:bg-gray-100 cursor-pointer dark:hover:bg-gray-800"},[e("td",ie,[e("div",ne,d(s+1)+". ",1)]),e("td",de,[p(H,{modelValue:o.item_id,"onUpdate:modelValue":n=>o.item_id=n,items:I(s),taggable:!0,"search-key":"name","label-key":"name",label:"Cari Barang",onTag:M,class:_(["w-full",i(a).errors[`items.${s}.item_id`]?"border-red-300 focus:border-red-500 focus:ring-red-500":"border-gray-300 focus:border-blue-500 focus:ring-blue-500"])},{item:N(({item:n})=>[e("div",le,[e("span",ce,d(n.name),1),e("span",ue,d(n.code||"-"),1)])]),_:1},8,["modelValue","onUpdate:modelValue","items","class"]),i(a).errors[`items.${s}.item_id`]?(c(),l("div",me,[t[6]||(t[6]=e("svg",{class:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)),e("span",null,d(Array.isArray(i(a).errors[`items.${s}.item_id`])?i(a).errors[`items.${s}.item_id`][0]:i(a).errors[`items.${s}.item_id`]),1)])):m("",!0)]),e("td",ge,[e("div",ye,[e("p",pe,d(o.code),1)])]),e("td",be,[e("div",fe,[e("p",xe,d(o.stock)+" "+d(o.unit?.short_name),1)])]),e("td",he,[e("div",ke,[z(e("input",{"onUpdate:modelValue":n=>o.quantity_transferred=n,type:"number",min:"0",class:_(["w-24 rounded dark:bg-gray-800 dark:text-white/90",i(a).errors[`items.${s}.quantity_transferred`]||$(o)?"border-red-300 focus:border-red-500 focus:ring-red-500":"border-gray-300 focus:border-blue-500 focus:ring-blue-500"])},null,10,_e),[[q,o.quantity_transferred]]),j(" "+d(o.unit?.short_name),1)]),i(a).errors[`items.${s}.quantity_transferred`]?(c(),l("div",ve,[t[7]||(t[7]=e("svg",{class:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)),e("span",null,d(Array.isArray(i(a).errors[`items.${s}.quantity_transferred`])?i(a).errors[`items.${s}.quantity_transferred`][0]:i(a).errors[`items.${s}.quantity_transferred`]),1)])):$(o)?(c(),l("div",we,[t[8]||(t[8]=e("svg",{class:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)),e("span",null,"Jumlah pengiriman tidak boleh melebihi stok tersedia ("+d(o.stock)+" "+d(o.unit?.short_name||"")+")",1)])):m("",!0)]),e("td",$e,[e("div",Be,[z(e("input",{"onUpdate:modelValue":n=>o.note=n,type:"text",placeholder:"Masukkan catatan",class:_(["w-40 h-10 text-sm rounded placeholder:text-gray-600 dark:bg-gray-800 dark:text-white/90",i(a).errors[`items.${s}.note`]?"border-red-300 focus:border-red-500 focus:ring-red-500":"border-gray-300 focus:border-blue-500 focus:ring-blue-500"])},null,10,Ce),[[q,o.note]])]),i(a).errors[`items.${s}.note`]?(c(),l("div",ze,[t[9]||(t[9]=e("svg",{class:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)),e("span",null,d(Array.isArray(i(a).errors[`items.${s}.note`])?i(a).errors[`items.${s}.note`][0]:i(a).errors[`items.${s}.note`]),1)])):m("",!0)]),e("td",je,[e("div",qe,[e("button",{onClick:n=>T(s)},[p(F,{class:"text-red-500"})],8,Ae)])])]))),128)),e("button",{type:"button",onClick:E,class:"m-4 px-3 py-2 text-white bg-green-500 hover:bg-green-600 rounded whitespace-nowrap"}," + Tambah Item ")])])]),i(a).errors.items?(c(),l("div",Ie,[e("div",Me,[t[11]||(t[11]=e("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)),e("span",null,d(Array.isArray(i(a).errors.items)?i(a).errors.items[0]:i(a).errors.items),1)])])):m("",!0)]),r.$page.props.flash?.success?(c(),l("div",Ee,[e("div",Te,[t[13]||(t[13]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-green-400",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})])],-1)),e("div",Se,[e("p",Ve,d(r.$page.props.flash.success),1)])])])):m("",!0),e("div",Le,[e("button",{type:"button",onClick:B,class:"inline-flex items-center rounded border bg-gray-400 border-gray-300 px-5 py-2 text-sm text-white hover:text-gray-800 hover:bg-gray-300 dark:border-gray-700 dark:text-gray-300"}," Batal "),e("button",{onClick:t[0]||(t[0]=o=>y.value=!0),class:"inline-flex items-center rounded bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 disabled:opacity-60"}," Kirim Barang ")]),y.value?(c(),l("div",Pe,[e("div",De,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:t[1]||(t[1]=o=>y.value=!1)}),e("div",Ne,[e("div",Oe,[e("div",Ue,[t[17]||(t[17]=e("div",{class:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 dark:bg-blue-900/20 sm:mx-0 sm:h-10 sm:w-10"},[e("svg",{class:"h-6 w-6 text-blue-600 dark:text-blue-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),e("div",Je,[t[16]||(t[16]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900 dark:text-gray-100",id:"modal-title"}," Konfirmasi Pengiriman Barang ",-1)),e("div",Ke,[t[15]||(t[15]=e("p",{class:"text-sm text-gray-500 dark:text-gray-400"}," Apakah Anda yakin ingin mengirim barang ini? Tindakan ini tidak dapat dibatalkan. ",-1)),e("div",Fe,[t[14]||(t[14]=e("p",{class:"text-sm font-medium text-gray-900 dark:text-gray-100 mb-2"},"Detail Pengiriman:",-1)),e("ul",He,[(c(!0),l(b,null,k(u.value.filter(o=>o.item_id),o=>(c(),l("li",{key:o.uid}," â€¢ "+d(o.name)+" - "+d(o.quantity_transferred)+" "+d(o.unit?.short_name||""),1))),128))])])])])])]),e("div",Ge,[e("button",{onClick:V,type:"button",class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed",disabled:i(a).processing},[i(a).processing?(c(),l("svg",Re,[...t[18]||(t[18]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):m("",!0),j(" "+d(i(a).processing?"Mengirim...":"Ya, Kirim Barang"),1)],8,Qe),e("button",{onClick:t[2]||(t[2]=o=>y.value=!1),type:"button",class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-800 text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"}," Batal ")])])])])):m("",!0)])],64))}});export{lt as default};
