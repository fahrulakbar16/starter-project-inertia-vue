import{u as P,d as f,y as S,e as l,o as m,b as p,a as e,g as a,D as B,t as c,f as y,F as k,i as U,w as A,E as g,h as N,G as b,H as O}from"./app-CJkCV51W.js";import{_ as T}from"./AppLayout-BlEKf3Fz.js";import{_ as D}from"./Breadcrumb-BJQpsGcc.js";import E from"./Form-D5acvznD.js";import{T as F}from"./TrashIcon-DSAHmBPH.js";import{_ as M}from"./SelectBarang-CRvJrPbK.js";import"./FlashMessage-D4C-FUm8.js";import"./LayoutShell-FWpWJLvi.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useAuth-DvuTgkfF.js";import"./LayoutShell.vue_vue_type_style_index_0_lang-CRqqKi3W.js";import"./SelectPemakaian-bo5sz744.js";const R={class:"flex overflow-hidden flex-col gap-3 px-3 h-full"},H={class:"flex justify-between items-center h-10"},G={class:"space-y-5 overflow-hidden rounded-lg border border-gray-200 bg-white p-6 dark:border-gray-700 dark:bg-white/[0.03]"},J={class:"flex items-center justify-between"},K={class:"font-bold text-sky-400 md:text-xl px-7"},L={class:"overflow-hidden rounded-lg border border-gray-200 bg-white dark:border-gray-700 dark:bg-white/[0.03]"},z={class:"overflow-auto","data-simplebar":""},Q={class:"min-w-full text-sm"},W={key:0},X={class:"w-4 py-2.5 border-y border-gray-200 dark:border-gray-600"},Y={class:"flex items-center whitespace-nowrap justify-center"},Z={class:"px-5 py-2.5 border border-gray-200 dark:border-gray-600"},ee={class:"flex flex-col"},te={class:"font-medium text-gray-900 dark:text-gray-100"},re={class:"text-xs text-gray-500 dark:text-gray-400"},se={key:0,class:"text-xs text-rose-600 mt-1"},ae={class:"py-2.5 border border-gray-200 dark:border-gray-600"},oe={class:"flex items-center px-3 whitespace-nowrap justify-center"},de={class:"text-gray-500 dark:text-gray-400"},ne={class:"py-2.5 border border-gray-200 dark:border-gray-600"},ie={class:"flex items-center gap-3 ps-6 whitespace-nowrap"},ce=["onUpdate:modelValue","onInput"],le={key:0,class:"text-xs text-rose-600 mt-1"},me={class:"py-2.5 border border-gray-200 dark:border-gray-600"},ue={class:"flex items-center gap-3 ps-6 whitespace-nowrap"},ye=["onUpdate:modelValue","onInput"],pe={key:0,class:"text-xs text-rose-600 mt-1"},ge={class:"py-2.5 border border-gray-200 dark:border-gray-600"},be={class:"flex items-center px-3 whitespace-nowrap justify-center"},he={class:"font-semibold text-gray-700 dark:text-gray-300"},_e={class:"py-2.5 border border-gray-200 dark:border-gray-600"},xe={class:"flex items-center whitespace-nowrap justify-center"},fe=["onUpdate:modelValue"],ke={key:0,class:"text-xs text-rose-600 mt-1"},we={class:"py-2.5 border-y border-gray-200 dark:border-gray-600"},ve={class:"flex justify-center whitespace-nowrap px-4 gap-3"},je=["onClick"],qe={key:0},Ie={class:"border-t-2 border-gray-300 dark:border-gray-600"},$e={class:"px-3 py-2 font-semibold text-center"},Ve={key:0,class:"px-6 py-3 text-xs text-rose-600"},Ce={class:"flex items-center gap-5 justify-end"},Pe=["disabled"],He=Object.assign({layout:T},{__name:"Edit",props:{po:{type:Object,required:!0},items:{type:Array,default:()=>[]},purchaseRequests:{type:Array,default:()=>[]},user:{type:Object,required:!0},isSuperadmin:{type:Boolean,required:!0},employees:{type:Array,default:()=>[]},branches:{type:Array,default:()=>[]}},setup(u){const w=[{label:"Penyimpanan"},{label:"Purchase Order",href:route("purchase-orders.index")},{label:"Edit Purchase Order"}],n=u,t=P({order_no:n.po.number,ordered_at:n.po.date,vendor:n.po.vendor,request_id:n.po.from_pr?.id||"",ordered_by:n.po.ordered_by,note:n.po.note||"",branch_id:n.po.branch_id||null,items:n.po.items.map(r=>({id:r.id,item_id:r.item_id,selectedItem:n.items.find(s=>s.id===r.item_id)||null,quantity_ordered:r.quantity_ordered,cost:r.cost,note:r.note||"",unit:r.unit,code:r.item_code||"",name:r.item_name||""})),employee_id:n.po.ordered_by,amount_paid:n.po.amount_paid||0}),v=f(!1);f({amount_paid:n.po.amount_paid||0});const j=()=>{t.items.push({item_id:"",selectedItem:null,quantity_ordered:1,cost:0,note:"",unit:"",code:"",name:""})},q=r=>{t.items.splice(r,1),t.items=[...t.items]},I=(r,s)=>{s&&s.id?(t.items[r].item_id=s.id,t.items[r].selectedItem=s,t.items[r].unit=s.unit?.short_name||"",t.items[r].code=s.code||"",t.items[r].name=s.name||""):(t.items[r].item_id="",t.items[r].selectedItem=null,t.items[r].unit="",t.items[r].code="",t.items[r].name=""),t.items=[...t.items]},$=r=>{const s=t.items.filter((o,d)=>d!==r&&o.item_id).map(o=>o.item_id);return n.items.filter(o=>!s.includes(o.id))},h=r=>{t.items[r]={...t.items[r]}},V=S(()=>t.items.reduce((r,s)=>r+s.quantity_ordered*s.cost,0)),C=()=>{if(t.items.length===0){alert("Minimal harus ada satu item");return}t.put(route("purchase-orders.update",n.po.id),{onSuccess:()=>{v.value=!1}})},_=()=>{O.get(route("purchase-orders.show",n.po.id))},x=r=>{try{return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",maximumFractionDigits:0}).format(r||0)}catch{return r}};return(r,s)=>(m(),l(k,null,[p(a(B),{title:`Edit Purchase Order ${u.po.number}`},null,8,["title"]),e("div",R,[e("div",H,[p(D,{items:w})]),e("div",G,[e("div",J,[s[0]||(s[0]=e("div",{class:"font-bold text-gray-700 md:text-xl dark:text-gray-300"}," Edit Purchase Order ",-1)),e("div",K,c(a(t).order_no),1)]),p(E,{form:a(t),purchaseRequests:u.purchaseRequests,items:u.items,user:u.user,isSuperadmin:u.isSuperadmin,employees:u.employees,branches:u.branches,onCancel:_},null,8,["form","purchaseRequests","items","user","isSuperadmin","employees","branches"])]),e("div",L,[s[5]||(s[5]=e("div",{class:"flex items-center justify-between px-6 py-4"},[e("div",{class:"font-semibold text-gray-700 dark:text-gray-200"}," Daftar Item ")],-1)),e("div",z,[e("table",Q,[s[4]||(s[4]=e("thead",null,[e("tr",null,[e("th",{class:"py-2.5 border-y border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800"},[e("div",{class:"flex items-center justify-center"},[e("p",{class:"flex flex-col items-center font-medium text-gray-500 whitespace-nowrap dark:text-gray-400"}," No. ")])]),e("th",{class:"py-3 border cursor-pointer border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800"},[e("div",{class:"flex items-center justify-center gap-2 px-3"},[e("p",{class:"font-medium text-gray-500 whitespace-nowrap dark:text-gray-400"}," Nama Barang ")])]),e("th",{class:"py-3 border border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800"},[e("div",{class:"flex cursor-pointer items-center justify-center gap-2 px-3"},[e("p",{class:"font-medium whitespace-nowrap text-gray-500 dark:text-gray-400"}," Kode Barang ")])]),e("th",{class:"py-3 border cursor-pointer border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800"},[e("div",{class:"flex items-center justify-center gap-2 px-3"},[e("p",{class:"font-medium text-gray-500 whitespace-nowrap dark:text-gray-400"}," Jumlah Pesan ")])]),e("th",{class:"py-3 border cursor-pointer border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800"},[e("div",{class:"flex items-center justify-center gap-2 px-3"},[e("p",{class:"font-medium text-gray-500 whitespace-nowrap dark:text-gray-400"}," Harga Satuan ")])]),e("th",{class:"py-3 border cursor-pointer border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800"},[e("div",{class:"flex items-center justify-center gap-2 px-3"},[e("p",{class:"font-medium text-gray-500 whitespace-nowrap dark:text-gray-400"}," Subtotal ")])]),e("th",{class:"py-3 border cursor-pointer border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800"},[e("div",{class:"flex items-center justify-center gap-2 px-3"},[e("p",{class:"font-medium text-gray-500 whitespace-nowrap dark:text-gray-400"}," Catatan ")])]),e("th",{class:"border-y border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800"},[e("div",{class:"flex items-center justify-center"},[e("p",{class:"font-medium text-gray-500 whitespace-nowrap dark:text-gray-400"}," Aksi ")])])])],-1)),e("tbody",null,[a(t).items.length===0?(m(),l("tr",W,[...s[1]||(s[1]=[e("td",{colspan:"8",class:"py-8 text-center text-gray-500"}," Belum ada item. Tambah item secara manual. ",-1)])])):y("",!0),(m(!0),l(k,null,U(a(t).items,(o,d)=>(m(),l("tr",{key:d,class:"hover:bg-gray-100 cursor-pointer dark:hover:bg-gray-800"},[e("td",X,[e("div",Y,c(d+1)+". ",1)]),e("td",Z,[p(M,{modelValue:o.selectedItem,"onUpdate:modelValue":[i=>o.selectedItem=i,i=>I(d,i)],items:$(d),label:"Pilih Item"},{item:A(({item:i})=>[e("div",ee,[e("span",te,c(i.name),1),e("span",re,c(i.code),1)])]),_:1},8,["modelValue","onUpdate:modelValue","items"]),a(t).errors[`items.${d}.item_id`]?(m(),l("div",se,c(a(t).errors[`items.${d}.item_id`][0]),1)):y("",!0)]),e("td",ae,[e("div",oe,[e("p",de,c(o.code),1)])]),e("td",ne,[e("div",ie,[g(e("input",{"onUpdate:modelValue":i=>o.quantity_ordered=i,onInput:i=>h(d),type:"number",min:"1",class:"w-24 rounded border-gray-300 dark:border-gray-700 dark:bg-gray-800 dark:text-white/90",required:""},null,40,ce),[[b,o.quantity_ordered,void 0,{number:!0}]]),N(" "+c(o.unit),1)]),a(t).errors[`items.${d}.quantity_ordered`]?(m(),l("div",le,c(a(t).errors[`items.${d}.quantity_ordered`]),1)):y("",!0)]),e("td",me,[e("div",ue,[g(e("input",{"onUpdate:modelValue":i=>o.cost=i,onInput:i=>h(d),type:"number",min:"0",step:"0.01",class:"w-32 rounded border-gray-300 dark:border-gray-700 dark:bg-gray-800 dark:text-white/90"},null,40,ye),[[b,o.cost,void 0,{number:!0}]])]),a(t).errors[`items.${d}.cost`]?(m(),l("div",pe,c(a(t).errors[`items.${d}.cost`]),1)):y("",!0)]),e("td",ge,[e("div",be,[e("p",he,c(x(o.quantity_ordered*o.cost)),1)])]),e("td",_e,[e("div",xe,[g(e("input",{"onUpdate:modelValue":i=>o.note=i,type:"text",placeholder:"Masukkan catatan",class:"w-40 h-10 text-sm rounded placeholder:text-gray-600 border-gray-300 dark:border-gray-700 dark:bg-gray-800 dark:text-white/90"},null,8,fe),[[b,o.note]])]),a(t).errors[`items.${d}.note`]?(m(),l("div",ke,c(a(t).errors[`items.${d}.note`]),1)):y("",!0)]),e("td",we,[e("div",ve,[e("button",{onClick:i=>q(d),type:"button"},[p(F,{class:"text-red-500"})],8,je)])])]))),128))]),a(t).items.length>0?(m(),l("tfoot",qe,[e("tr",Ie,[s[2]||(s[2]=e("td",{colspan:"5",class:"px-3 py-2 text-right font-semibold"},"Total:",-1)),e("td",$e,c(x(V.value)),1),s[3]||(s[3]=e("td",{colspan:"2"},null,-1))])])):y("",!0)]),e("button",{type:"button",onClick:j,class:"m-4 px-3 py-2 text-white bg-green-500 hover:bg-green-600 rounded whitespace-nowrap"}," + Tambah Item ")]),a(t).errors.items?(m(),l("div",Ve,c(a(t).errors.items[0]),1)):y("",!0)]),e("div",Ce,[e("button",{type:"button",onClick:_,class:"inline-flex items-center rounded border bg-gray-400 border-gray-300 px-5 py-2 text-sm text-white hover:text-gray-800 hover:bg-gray-300 dark:border-gray-700 dark:text-gray-300"}," Batal "),e("button",{onClick:C,disabled:a(t).processing||a(t).items.length===0,class:"inline-flex items-center rounded bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 disabled:opacity-60"},c(a(t).processing?"Menyimpan...":"Simpan Perubahan"),9,Pe)])])],64))}});export{He as default};
