import{d as y,x as B,u as F,z as C,L as O,e as u,o as m,b as f,a as r,g as k,D as V,f as b,t as l,F as I,i as K,E as j,G as E,n as G,S as H,H as W}from"./app-CJkCV51W.js";import{_ as Y}from"./AppLayout-BlEKf3Fz.js";import{_ as Q}from"./Breadcrumb-BJQpsGcc.js";import X from"./Form-ZhP-zITN.js";import{T as Z}from"./TrashIcon-DSAHmBPH.js";import{_ as ee}from"./SelectBarang-CRvJrPbK.js";import{v as _}from"./v4-BKrj-4V8.js";import"./FlashMessage-D4C-FUm8.js";import"./LayoutShell-FWpWJLvi.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useAuth-DvuTgkfF.js";import"./LayoutShell.vue_vue_type_style_index_0_lang-CRqqKi3W.js";import"./SelectPemakaian-bo5sz744.js";const te={class:"flex overflow-hidden flex-col gap-3 px-3 h-full"},ae={class:"flex justify-between items-center h-10"},re={class:"space-y-5 overflow-hidden rounded-lg border border-gray-200 bg-white p-6 dark:border-gray-700 dark:bg-white/[0.03] relative z-1"},se={key:0,class:"text-xs text-rose-600 mt-1"},ie={key:1,class:"text-xs text-rose-600 mt-1"},oe={key:2,class:"text-xs text-rose-600 mt-1"},ne={key:3,class:"text-xs text-rose-600 mt-1"},de={class:"rounded-lg border border-gray-200 bg-white dark:border-gray-700 dark:bg-white/[0.03] relative"},le={class:"overflow-auto relative","data-simplebar":""},ue={class:"min-w-full text-sm border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden"},me={class:"py-2.5 px-3 border-b border-gray-200 dark:border-gray-600 text-center align-middle"},ce={class:"py-2.5 px-3 border-b border-gray-200 dark:border-gray-600 align-middle"},ge={key:0,class:"text-xs text-rose-600 mt-1"},be={class:"py-2.5 px-3 border-b border-gray-200 dark:border-gray-600 align-middle text-center"},pe={class:"text-gray-500 dark:text-gray-400"},ye={class:"py-2.5 px-3 border-b border-gray-200 dark:border-gray-600 align-middle text-center"},fe={class:"text-gray-500 dark:text-gray-400"},xe={class:"py-2.5 px-3 border-b border-gray-200 dark:border-gray-600 align-middle"},ve={class:"flex items-center gap-2 justify-center w-full"},he=["onUpdate:modelValue","max","onInput"],ke={class:"text-gray-500 dark:text-gray-400"},_e={key:0,class:"text-xs text-rose-600 mt-1"},we={class:"py-2.5 px-3 border-b border-gray-200 dark:border-gray-600 align-middle"},Ne=["onUpdate:modelValue"],qe={key:0,class:"text-xs text-rose-600 mt-1"},Be={class:"py-2.5 px-3 border-b border-gray-200 dark:border-gray-600 align-middle text-center"},Ce=["onClick"],Se={key:0,class:"px-6 py-3 text-xs text-rose-600"},Ie={key:0,class:"fixed inset-0 z-50 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},je={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},Ee={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full dark:bg-gray-800"},Le={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse dark:bg-gray-700"},Ke=Object.assign({layout:Y},{__name:"Create",props:{user:Object,departments:{type:Array,required:!0},materialRequests:{type:Array,required:!0},items:{type:Array,default:()=>[]},sortBy:String,sortDirection:String,isSuperadmin:{type:Boolean,required:!0}},setup(x){const L=[{label:"Penyimpanan"},{label:"Pemakaian Barang",href:route("good-issues.index")},{label:"Buat Log"}],w=x,g=y([]),p=y(!1);function A(t){const e={id:Date.now(),name:t,code:"-",stock:0};return g.value.push(e),e}const D=t=>{const e=n.value.map((a,i)=>i!==t?a.item_id:null).filter(a=>a&&typeof a=="object"&&a.id).map(a=>a.id);return g.value.filter(a=>!e.includes(a.id))};function N(t){C(()=>t.item_id,e=>{if(e){if(typeof e=="object"&&e!==null)t.code=e.code,t.name=e.name,t.stock=e.stock,t.unit=e.unit;else if(typeof e=="string"){const a=A(e);t.item_id=a,t.code=a.code,t.name=a.name,t.stock=a.stock,t.unit=a.unit}}else t.code="",t.name="",t.stock="",t.unit={};v(t)},{immediate:!0}),C(()=>t.stock,()=>{t.item_id&&t.item_id.id&&v(t)})}const n=y([B({uid:_(),item_id:null,amount:1,code:"",name:"",stock:"",unit:{},note:""})]),o=y([]),d=y({}),q=()=>{const t=B({uid:_(),item_id:null,amount:1,code:"",name:"",stock:"",unit:{},note:""});N(t),n.value.push(t),o.value.push({})};n.value.forEach((t,e)=>{N(t),o.value[e]||(o.value[e]={})});const J=t=>{n.value.splice(t,1),o.value.splice(t,1),n.value.forEach(e=>{e.item_id&&e.item_id.id&&v(e)})};function $(t){if(!t||t.length===0){n.value.length===0&&q();return}const e=t.map(s=>({id:s.id,name:s.name,code:s.code,stock:s.stock,unit:s.unit})),a=g.value.map(s=>s.id),i=e.filter(s=>!a.includes(s.id));g.value=[...g.value,...i],n.value=[],o.value=[],t.forEach(s=>{const h=B({uid:_(),item_id:{id:s.id,name:s.name,code:s.code,stock:s.stock,unit:s.unit},amount:s.quantity_approved||s.quantity_requested||1,code:s.code,name:s.name,stock:s.stock,unit:s.unit,note:s.note||""});N(h),n.value.push(h),o.value.push({})})}function T(){n.value=[],o.value=[],q()}const c=F({department_id:w.user?.employee?.department_id,request_id:null,date:new Date().toISOString().slice(0,10),requirement:"",items:[{uid:_(),item_id:null,amount:1,note:""}]});C(()=>c.department_id,async t=>{if(!t){g.value=[];return}try{const e=await O.get(route("material-requests.items.by-department"),{params:{department_id:t}});g.value=e.data.items}catch(e){console.error("Error loading items by department:",e),g.value=[]}},{immediate:!0});function v(t){let e,a;if(typeof t=="number"?(e=t,a=n.value[e]):(a=t,e=n.value.findIndex(i=>i.uid===a.uid)),!(e===-1||!a)&&(o.value[e]||(o.value[e]={}),o.value[e].amount&&delete o.value[e].amount,a.item_id&&a.item_id.id)){const i=Number(a.stock),s=Number(a.amount);a.amount===null||a.amount===""||isNaN(s)?o.value[e].amount="Jumlah harus berupa angka bulat.":Number.isInteger(s)?s<1?o.value[e].amount="Jumlah harus minimal 1.":!isNaN(i)&&i>=0&&s>i&&(o.value[e].amount="Jumlah permintaan tidak boleh lebih dari stok tersedia."):o.value[e].amount="Jumlah harus berupa angka bulat."}}function R(){let t=!0;return o.value=[],n.value.length?d.value.items=null:(d.value.items=["Minimal 1 item harus diisi."],t=!1),n.value.forEach((e,a)=>{const i={};if(!e.item_id||!e.item_id.id?(i.item_id="Barang harus dipilih.",t=!1):e.item_id&&e.item_id.id&&!g.value.some(s=>s.id===e.item_id.id)&&(i.item_id="Barang tidak valid.",t=!1),e.amount===null||e.amount===""||isNaN(e.amount)||!Number.isInteger(Number(e.amount)))i.amount="Jumlah harus berupa angka bulat.",t=!1;else if(Number(e.amount)<1)i.amount="Jumlah harus minimal 1.",t=!1;else{const s=Number(e.stock),h=Number(e.amount);!isNaN(s)&&s>=0&&h>s&&(i.amount="Jumlah permintaan tidak boleh lebih dari stok tersedia.",t=!1)}e.note&&typeof e.note!="string"?(i.note="Catatan harus berupa teks.",t=!1):e.note&&e.note.length>225&&(i.note="Catatan maksimal 225 karakter.",t=!1),o.value[a]=i}),t}function U(){let t=!0;return d.value={},c.department_id?w.departments&&!w.departments.some(e=>e.id==c.department_id)&&(d.value.department_id="Departemen tidak valid.",t=!1):(d.value.department_id="Departemen harus dipilih.",t=!1),c.requirement&&typeof c.requirement!="string"&&(d.value.requirement="Keterangan harus berupa teks.",t=!1),R()||(t=!1),t}function z(){U()&&(p.value=!0)}function M(){p.value=!1,P()}function P(){c.items=n.value.map(t=>({uid:t.uid,item_id:t.item_id?.id??null,amount:t.amount,note:t.note??null})),c.post(route("good-issues.store"))}function S(){W.get(route("good-issues.index"))}return(t,e)=>(m(),u(I,null,[f(k(V),{title:"Tambah Permintaan Barang"}),r("div",te,[r("div",ae,[f(Q,{items:L})]),r("div",re,[e[2]||(e[2]=r("h1",{class:"text-lg font-semibold text-gray-700 dark:text-gray-200"}," Buat Log Pemakaian Barang ",-1)),f(X,{form:k(c),departments:x.departments,materialRequests:x.materialRequests,isSuperadmin:x.isSuperadmin,onCancel:S,onItemsLoaded:$,onResetItems:T},null,8,["form","departments","materialRequests","isSuperadmin"]),d.value.department_id?(m(),u("div",se,l(d.value.department_id),1)):b("",!0),d.value.request_id?(m(),u("div",ie,l(d.value.request_id),1)):b("",!0),d.value.date?(m(),u("div",oe,l(d.value.date),1)):b("",!0),d.value.requirement?(m(),u("div",ne,l(d.value.requirement),1)):b("",!0)]),r("div",de,[e[4]||(e[4]=r("div",{class:"flex items-center justify-between px-6 py-4"},[r("div",{class:"font-semibold text-gray-700 dark:text-gray-200"}," Daftar Item ")],-1)),r("div",le,[r("table",ue,[e[3]||(e[3]=r("thead",null,[r("tr",{class:"bg-gray-100 dark:bg-gray-800"},[r("th",{class:"py-2.5 px-3 border-b border-gray-200 dark:border-gray-600 text-center font-medium text-gray-500 dark:text-gray-400 w-10"}," No. "),r("th",{class:"py-2.5 px-3 border-b border-gray-200 dark:border-gray-600 text-center font-medium text-gray-500 dark:text-gray-400 min-w-[170px]"}," Nama Barang "),r("th",{class:"py-2.5 px-3 border-b border-gray-200 dark:border-gray-600 text-center font-medium text-gray-500 dark:text-gray-400 min-w-[110px]"}," Kode Barang "),r("th",{class:"py-2.5 px-3 border-b border-gray-200 dark:border-gray-600 text-center font-medium text-gray-500 dark:text-gray-400 min-w-[120px]"}," Stok Tersedia "),r("th",{class:"py-2.5 px-3 border-b border-gray-200 dark:border-gray-600 text-center font-medium text-gray-500 dark:text-gray-400 min-w-[140px]"}," Jumlah Permintaan "),r("th",{class:"py-2.5 px-3 border-b border-gray-200 dark:border-gray-600 text-center font-medium text-gray-500 dark:text-gray-400 min-w-[140px]"}," Catatan "),r("th",{class:"py-2.5 px-3 border-b border-gray-200 dark:border-gray-600 text-center font-medium text-gray-500 dark:text-gray-400 w-16"}," Aksi ")])],-1)),r("tbody",null,[(m(!0),u(I,null,K(n.value,(a,i)=>(m(),u("tr",{key:a.uid,class:"hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors"},[r("td",me,l(i+1),1),r("td",ce,[f(ee,{modelValue:a.item_id,"onUpdate:modelValue":s=>a.item_id=s,items:D(i),taggable:!0,label:"Cari Barang","label-key":"name","search-key":"name"},null,8,["modelValue","onUpdate:modelValue","items"]),o.value[i]&&o.value[i].item_id?(m(),u("div",ge,l(o.value[i].item_id),1)):b("",!0)]),r("td",be,[r("span",pe,l(a.code),1)]),r("td",ye,[r("span",fe,l(a.stock)+" "+l(a.unit?.short_name),1)]),r("td",xe,[r("div",ve,[j(r("input",{"onUpdate:modelValue":s=>a.amount=s,type:"number",min:1,max:a.stock&&!isNaN(Number(a.stock))?Number(a.stock):void 0,onInput:s=>v(i),class:G(["w-20 rounded border-gray-300 dark:border-gray-700 dark:bg-gray-800 dark:text-white/90",{"border-red-500":o.value[i]&&o.value[i].amount}])},null,42,he),[[E,a.amount,void 0,{number:!0}]]),r("span",ke,l(a.unit?.short_name),1)]),o.value[i]&&o.value[i].amount?(m(),u("div",_e,l(o.value[i].amount),1)):b("",!0)]),r("td",we,[j(r("input",{"onUpdate:modelValue":s=>a.note=s,type:"text",placeholder:"Masukkan catatan",class:"w-full h-10 text-sm rounded placeholder:text-gray-600 border-gray-300 dark:border-gray-700 dark:bg-gray-800 dark:text-white/90"},null,8,Ne),[[E,a.note]]),o.value[i]&&o.value[i].note?(m(),u("div",qe,l(o.value[i].note),1)):b("",!0)]),r("td",Be,[r("button",{onClick:s=>J(i),type:"button",class:"flex items-center justify-center mx-auto"},[f(Z,{class:"text-red-500"})],8,Ce)])]))),128))])])]),k(c).errors.items?(m(),u("div",Se,l(k(c).errors.items[0]),1)):b("",!0),r("div",{class:"px-6 py-4 border-t border-gray-200 dark:border-gray-600 bg-gray-50 dark:bg-gray-700"},[r("button",{type:"button",onClick:q,class:"px-4 py-2 text-white bg-green-500 hover:bg-green-600 rounded whitespace-nowrap transition-colors duration-200"}," + Tambah Item ")])]),r("div",{class:"flex items-center gap-5 justify-end"},[r("button",{type:"button",onClick:S,class:"inline-flex items-center rounded border bg-gray-400 border-gray-300 px-5 py-2 text-sm text-white hover:text-gray-800 hover:bg-gray-300 dark:border-gray-700 dark:text-gray-300"}," Batal "),r("button",{onClick:z,class:"inline-flex items-center rounded bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 disabled:opacity-60"}," Simpan ")]),p.value?(m(),u("div",Ie,[r("div",je,[r("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:e[0]||(e[0]=a=>p.value=!1)}),e[6]||(e[6]=r("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"â€‹",-1)),r("div",Ee,[e[5]||(e[5]=H('<div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4 dark:bg-gray-800"><div class="sm:flex sm:items-start"><div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 sm:mx-0 sm:h-10 sm:w-10 dark:bg-blue-900"><svg class="h-6 w-6 text-blue-600 dark:text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path></svg></div><div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left"><h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-gray-100" id="modal-title"> Konfirmasi Simpan </h3><div class="mt-2"><p class="text-sm text-gray-500 dark:text-gray-400"> Apakah Anda yakin ingin menyimpan data pemakaian barang ini? </p></div></div></div></div>',1)),r("div",Le,[r("button",{type:"button",onClick:M,class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm"}," Ya, Simpan "),r("button",{type:"button",onClick:e[1]||(e[1]=a=>p.value=!1),class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm dark:bg-gray-600 dark:text-gray-300 dark:border-gray-500 dark:hover:bg-gray-500"}," Batal ")])])])])):b("",!0)])],64))}});export{Ke as default};
