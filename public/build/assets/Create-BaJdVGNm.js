import{d as _,u as L,z as q,l as $,A as F,e as n,o,b as y,a as e,g as c,D as R,f as g,t as p,E as x,J as O,F as V,i as J,G as k,n as K,K as H,S as G,h as W,x as M,H as Y}from"./app-CJkCV51W.js";import{_ as Q}from"./AppLayout-BlEKf3Fz.js";import{_ as X}from"./Breadcrumb-BJQpsGcc.js";import Z from"./CreateReceiptForm-B58NC3gO.js";import ee from"./CreateTranferForm-CNYni9Aa.js";import{T as te}from"./TrashIcon-DSAHmBPH.js";import{_ as re}from"./SelectBarang-CRvJrPbK.js";import{v as P}from"./v4-BKrj-4V8.js";import"./FlashMessage-D4C-FUm8.js";import"./LayoutShell-FWpWJLvi.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useAuth-DvuTgkfF.js";import"./LayoutShell.vue_vue_type_style_index_0_lang-CRqqKi3W.js";import"./SelectPemakaian-bo5sz744.js";const ae={class:"flex overflow-hidden flex-col gap-3 px-3 h-full"},de={class:"flex justify-between items-center h-10"},ne={class:"space-y-5 overflow-hidden rounded-lg border border-gray-200 bg-white p-6 dark:border-gray-700 dark:bg-white/[0.03]"},oe={class:"flex items-center justify-between"},ie={class:"font-bold text-sky-400 md:text-xl px-7"},se={class:"space-y-5"},le={class:"space-y-2 m-5"},ue={key:0},ce={key:1},me={class:"overflow-hidden rounded-lg border border-gray-200 bg-white dark:border-gray-700 dark:bg-white/[0.03]"},ye={class:"overflow-auto","data-simplebar":""},ge={class:"min-w-full text-sm border border-gray-200 dark:border-gray-600 rounded-lg"},be={class:"py-2.5 px-3 border-b border-gray-200 dark:border-gray-600 text-center align-middle"},pe={class:"py-2.5 px-3 border-b border-gray-200 dark:border-gray-600 align-middle min-w-[180px]"},xe={class:"py-2.5 px-3 border-b border-gray-200 dark:border-gray-600 align-middle min-w-[120px]"},he={class:"flex items-center gap-2 justify-center"},fe=["onUpdate:modelValue"],ve={class:"py-2.5 px-3 border-b border-gray-200 dark:border-gray-600 align-middle min-w-[140px]"},_e={class:"flex items-center gap-2 justify-center"},ke=["onUpdate:modelValue"],we={class:"py-2.5 px-3 border-b border-gray-200 dark:border-gray-600 align-middle min-w-[180px]"},qe={class:"relative"},Ce=["onUpdate:modelValue","placeholder"],je={key:0,class:"absolute -top-1 -right-1 text-red-500 text-xs font-bold"},Se={class:"py-2.5 px-3 border-b border-gray-200 dark:border-gray-600 align-middle min-w-[140px]"},Be=["onUpdate:modelValue"],Ve={class:"py-2.5 px-3 border-b border-gray-200 dark:border-gray-600 text-center align-middle"},Me=["onClick"],Pe={key:0,class:"px-6 py-3 text-xs text-rose-600"},Ue={key:1,class:"px-6 py-3 text-xs text-amber-600 bg-amber-50 dark:bg-amber-900/20"},Ae={class:"flex items-center gap-5 justify-end"},De=["disabled"],Ie={class:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full mx-4"},Ne={class:"p-6"},Ee={class:"flex justify-end space-x-3"},Te=["disabled"],ze={key:0,class:"flex items-center"},Le={key:1},tt=Object.assign({layout:Q},{__name:"Create",props:{orderNo:String,user:Object,employees:{type:Array,required:!0},items:{type:Array,default:()=>[]},sortBy:String,sortDirection:String,order:{type:Array,required:!0},transfer:{type:Array,required:!0},departments:{type:Array,required:!0},isSuperadmin:{type:Boolean,required:!0}},setup(l){const U=[{label:"Penyimpanan"},{label:"Penerimaan Barang",href:route("good-receipts.index")},{label:"Buat Penerimaan"}],u=_("pembelian"),h=_(!1),C=l,w=_(C.items.map(t=>({id:t.id,name:t.name,code:t.code,unit:t.unit}))),A=t=>{const r=i.value.map((a,m)=>m!==t?a.item_id:null).filter(a=>a&&typeof a=="object"&&a.id).map(a=>a.id);return w.value.filter(a=>!r.includes(a.id))},f=t=>t.quantity_actually_received!==t.quantity_received,v=()=>i.value.every(t=>f(t)?t.received_note&&t.received_note.trim()!=="":!0);function D(t){const r={id:Date.now(),name:t,code:"-"};return w.value.push(r),r}function j(t){q(()=>t.item_id,r=>{if(r){if(typeof r=="object"&&r!==null)t.code=r.code,t.name=r.name,t.unit=r.unit;else if(typeof r=="string"){const a=D(r);t.item_id=a,t.code=a.code,t.name=a.name,t.unit=a.unit}}else t.code="",t.name="",t.unit={}},{immediate:!0})}const i=_([]),I=()=>{const t=M({uid:P(),item_id:null,quantity_received:1,quantity_actually_received:0,code:"",name:"",unit:{},note:"",received_note:""});j(t),i.value.push(t)},N=t=>{i.value.splice(t,1)},d=L({employee_id:C.user?.employee?.id,order_id:null,transfer_id:null,source:"",note:"",received_at:new Date().toISOString().slice(0,10),items:[]});function S(t){if(!t||t.length===0){i.value=[];return}i.value=t.map(r=>{const a=M({uid:P(),item_id:w.value.find(m=>m.id===r.item_id)??null,code:r.code,name:r.name,unit:r.unit,quantity_received:r.quantity_requested,quantity_actually_received:r.quantity_requested,note:r.note,received_note:""});return j(a),a})}q(()=>d.order_id,t=>{if(!t||u.value!=="pembelian"){i.value=[];return}}),q(()=>d.transfer_id,t=>{if(!t||u.value!=="pemindahan"){i.value=[];return}});function E(){if(!v()){alert("Catatan penerimaan wajib diisi untuk item yang jumlah diterimanya berbeda dengan jumlah barang.");return}h.value=!0}function b(){h.value=!1}function T(){if(!v()){alert("Catatan penerimaan wajib diisi untuk item yang jumlah diterimanya berbeda dengan jumlah barang.");return}d.items=i.value.map(t=>({uid:t.uid,item_id:t.item_id?.id??null,quantity_received:t.quantity_received,quantity_actually_received:t.quantity_actually_received,note:t.note??null,received_note:t.received_note??null})),u.value==="pembelian"?d.transfer_id=null:d.order_id=null,d.post(route("good-receipts.store"),{onSuccess:()=>{b()},onError:()=>{b()}})}function z(){Y.get(route("good-receipts.index"))}function B(t){t.key==="Escape"&&h.value&&b()}return $(()=>{document.addEventListener("keydown",B)}),F(()=>{document.removeEventListener("keydown",B)}),(t,r)=>(o(),n(V,null,[y(c(R),{title:u.value==="pembelian"?"Buat Penerimaan Barang (Pembelian)":"Buat Penerimaan Barang (Pemindahan)"},null,8,["title"]),e("div",ae,[e("div",de,[y(X,{items:U})]),e("div",ne,[e("div",oe,[r[1]||(r[1]=e("div",{class:"font-bold text-gray-700 md:text-xl dark:text-gray-300 m-5"}," Form Penerimaan Barang ",-1)),e("div",ie,p(c(d).order_no),1)]),e("div",se,[e("div",le,[r[3]||(r[3]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," Sumber Penerimaan ",-1)),x(e("select",{"onUpdate:modelValue":r[0]||(r[0]=a=>u.value=a),class:"h-10 px-3 w-full border border-gray-300 rounded-md text-sm dark:border-gray-700 dark:bg-gray-800 dark:text-white/90"},[...r[2]||(r[2]=[e("option",{value:"pembelian"},"Pembelian",-1),e("option",{value:"pemindahan"},"Pemindahan",-1)])],512),[[O,u.value]])]),u.value==="pembelian"?(o(),n("div",ue,[y(Z,{form:c(d),orders:l.order,employees:l.employees,user:l.user,onItemsLoaded:S,isSuperadmin:l.isSuperadmin,isEdit:!1},null,8,["form","orders","employees","user","isSuperadmin"])])):g("",!0),u.value==="pemindahan"?(o(),n("div",ce,[y(ee,{form:c(d),transfers:l.transfer,employees:l.employees,user:l.user,onItemsLoaded:S,isSuperadmin:l.isSuperadmin,isEdit:!1},null,8,["form","transfers","employees","user","isSuperadmin"])])):g("",!0)])]),e("div",me,[r[5]||(r[5]=e("div",{class:"flex items-center justify-between px-6 py-4"},[e("div",{class:"font-semibold text-gray-700 dark:text-gray-200"}," Daftar Item ")],-1)),e("div",ye,[e("table",ge,[r[4]||(r[4]=e("thead",null,[e("tr",null,[e("th",{class:"py-2.5 px-3 border-b border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800 text-center font-medium text-gray-500 whitespace-nowrap dark:text-gray-400 w-10"}," No. "),e("th",{class:"py-2.5 px-3 border-b border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800 text-center font-medium text-gray-500 whitespace-nowrap dark:text-gray-400"}," Nama Barang "),e("th",{class:"py-2.5 px-3 border-b border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800 text-center font-medium text-gray-500 whitespace-nowrap dark:text-gray-400"}," Jumlah Barang "),e("th",{class:"py-2.5 px-3 border-b border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800 text-center font-medium text-gray-500 whitespace-nowrap dark:text-gray-400"}," Jumlah Diterima "),e("th",{class:"py-2.5 px-3 border-b border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800 text-center font-medium text-gray-500 whitespace-nowrap dark:text-gray-400"}," Catatan Diterima "),e("th",{class:"py-2.5 px-3 border-b border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800 text-center font-medium text-gray-500 whitespace-nowrap dark:text-gray-400"}," Catatan "),e("th",{class:"py-2.5 px-3 border-b border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800 text-center font-medium text-gray-500 whitespace-nowrap dark:text-gray-400 w-16"}," Aksi ")])],-1)),e("tbody",null,[(o(!0),n(V,null,J(i.value,(a,m)=>(o(),n("tr",{key:a.uid,class:"hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors"},[e("td",be,p(m+1),1),e("td",pe,[y(re,{modelValue:a.item_id,"onUpdate:modelValue":s=>a.item_id=s,items:A(m),taggable:!0,label:"Cari Barang","label-key":"name","search-key":"name",readonly:"true",disabled:"true"},null,8,["modelValue","onUpdate:modelValue","items"])]),e("td",xe,[e("div",he,[x(e("input",{"onUpdate:modelValue":s=>a.quantity_received=s,type:"number",min:"0",class:"w-20 rounded border-gray-300 dark:border-gray-700 dark:bg-gray-800 dark:text-white/90 text-center readonly:bg-gray-100 dark:readonly:bg-gray-700",readonly:"true",disabled:"true"},null,8,fe),[[k,a.quantity_received]]),e("span",null,p(a.unit?.short_name),1)])]),e("td",ve,[e("div",_e,[x(e("input",{"onUpdate:modelValue":s=>a.quantity_actually_received=s,type:"number",min:"0",placeholder:"0",class:"w-20 rounded border-gray-300 dark:border-gray-700 dark:bg-gray-800 dark:text-white/90 text-center"},null,8,ke),[[k,a.quantity_actually_received]]),e("span",null,p(a.unit?.short_name),1)])]),e("td",we,[e("div",qe,[x(e("input",{"onUpdate:modelValue":s=>a.received_note=s,type:"text",placeholder:f(a)?"Catatan penerimaan (wajib diisi)":"Catatan penerimaan",class:K(["w-full h-9 px-2 text-sm rounded placeholder:text-gray-600 border-gray-300 dark:border-gray-700 dark:bg-gray-800 dark:text-white/90",f(a)&&(!a.received_note||a.received_note.trim()==="")?"border-red-500 focus:border-red-500 focus:ring-red-500":"border-gray-300 dark:border-gray-700"])},null,10,Ce),[[k,a.received_note]]),f(a)?(o(),n("span",je," * ")):g("",!0)])]),e("td",Se,[x(e("input",{"onUpdate:modelValue":s=>a.note=s,type:"text",placeholder:"Masukkan catatan",class:"w-full h-9 px-2 text-sm rounded placeholder:text-gray-600 border-gray-300 dark:border-gray-700 dark:bg-gray-800 dark:text-white/90"},null,8,Be),[[k,a.note]])]),e("td",Ve,[e("button",{onClick:s=>N(m),class:"hover:bg-red-50 dark:hover:bg-red-900 p-1 rounded transition-colors"},[y(te,{class:"text-red-500"})],8,Me)])]))),128)),e("button",{type:"button",onClick:I,class:"m-4 px-3 py-2 text-white bg-green-500 hover:bg-green-600 rounded whitespace-nowrap"}," + Tambah Item ")])])]),c(d).errors.requests?(o(),n("div",Pe,p(c(d).errors.requests[0]),1)):g("",!0),v()?g("",!0):(o(),n("div",Ue," ⚠️ Catatan penerimaan wajib diisi untuk item yang jumlah diterimanya berbeda dengan jumlah barang. "))]),e("div",Ae,[e("button",{type:"button",onClick:z,class:"inline-flex items-center rounded border bg-gray-400 border-gray-300 px-5 py-2 text-sm text-white hover:text-gray-800 hover:bg-gray-300 dark:border-gray-700 dark:text-gray-300"}," Batal "),e("button",{onClick:E,disabled:!v(),class:"inline-flex items-center rounded bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 disabled:opacity-60 disabled:cursor-not-allowed"}," Simpan Penerimaan ",8,De)]),h.value?(o(),n("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:H(b,["self"])},[e("div",Ie,[e("div",Ne,[r[7]||(r[7]=G('<div class="flex items-center mb-4"><div class="flex-shrink-0"><svg class="w-8 h-8 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div><div class="ml-3"><h3 class="text-lg font-medium text-gray-900 dark:text-white"> Konfirmasi Simpan </h3></div></div><div class="mb-6"><p class="text-sm text-gray-500 dark:text-gray-400"> Apakah Anda yakin ingin menyimpan penerimaan barang ini? </p></div>',2)),e("div",Ee,[e("button",{onClick:b,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 dark:bg-gray-600 dark:text-gray-300 dark:border-gray-500 dark:hover:bg-gray-500"}," Batal "),e("button",{onClick:T,disabled:c(d).processing,class:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed"},[c(d).processing?(o(),n("span",ze,[...r[6]||(r[6]=[e("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),W(" Menyimpan... ",-1)])])):(o(),n("span",Le,"Ya, Simpan"))],8,Te)])])])])):g("",!0)])],64))}});export{tt as default};
