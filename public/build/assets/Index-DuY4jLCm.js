import{d as y,y as F,z as N,u as pt,U as ft,e as l,o as i,b as f,a as t,g as r,D as gt,f as g,E as k,w as L,t as o,J as W,h as S,G as C,F as B,i as U,H as J}from"./app-CJkCV51W.js";import{_ as vt}from"./AppLayout-BlEKf3Fz.js";import{_ as yt}from"./Breadcrumb-BJQpsGcc.js";import{_ as R}from"./SelectBrng-C5pMKisR.js";import{_ as xt}from"./Pagination-C2dOEo8X.js";import{_ as X}from"./Modal-Ddbg9qvg.js";import{u as bt}from"./useAuth-DvuTgkfF.js";import"./FlashMessage-D4C-FUm8.js";import"./LayoutShell-FWpWJLvi.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./LayoutShell.vue_vue_type_style_index_0_lang-CRqqKi3W.js";const kt={class:"flex flex-col h-full gap-3 px-3 overflow-hidden"},_t={class:"flex items-center justify-between h-10"},ht={class:"flex flex-col overflow-hidden bg-white border border-gray-200 rounded-lg"},St={class:"flex flex-col h-16 gap-2 px-8 sm:flex-row sm:items-center sm:justify-between"},wt={class:"flex items-center gap-3"},Ct={class:"overflow-auto overflow-x-auto","data-simplebar":""},Bt={class:"min-w-full text-sm table-fixed"},Mt={class:"py-2.5 bg-gray-100 border-y"},Tt={class:"py-2.5 bg-gray-100 border-y"},Dt={class:"py-2.5 bg-gray-100 border-y"},Vt={class:"py-2.5 bg-gray-100 border-y"},$t={class:"py-2.5 bg-gray-100 border-y"},jt={colspan:"2",class:"p-2 bg-gray-50 border-y"},Et={class:"relative w-full max-w-xs mx-auto"},At={colspan:"4",class:"px-2 text-left border bg-gray-50"},Nt=["value"],Ut={class:"p-2 border bg-gray-50"},qt={class:"space-x-2 whitespace-nowrap"},Ft={key:0},Lt={colspan:9,class:"px-4 py-2 font-semibold text-gray-600 bg-gray-50"},Ot=["onClick"],Ht={class:"text-xs"},Gt={class:"ml-1 text-xs text-gray-500"},Pt={class:"p-3 text-center"},It={class:"p-3 font-mono text-center"},zt={key:0,class:"font-mono"},Qt={key:1,class:"inline-flex px-2 py-0.5 text-xs font-medium text-gray-600 bg-gray-100 rounded"},Kt={class:"p-3 text-center"},Wt={class:"p-3 text-center"},Jt={class:"p-3 font-semibold text-center text-green-400"},Rt={class:"p-3 text-center"},Xt={class:"p-3 text-center whitespace-nowrap"},Yt={class:"p-3 text-center"},Zt={key:0},te={key:1,class:"italic text-gray-400"},ee={class:"p-3 text-center"},se={class:"flex items-center justify-center gap-3"},ne=["onClick"],ae=["onClick"],oe={class:"p-3 text-center"},le={class:"p-3 text-center"},ie={key:0,class:"font-mono"},re={key:1,class:"inline-flex px-2 py-0.5 text-xs font-medium text-gray-600 bg-gray-100 rounded"},de={class:"flex items-center justify-center gap-3 whitespace-nowrap"},ue={class:"font-semibold"},ce={class:"p-3 text-center"},me={class:"p-3 font-semibold text-center text-green-400"},pe={class:"p-3 text-center"},fe={class:"p-3 text-center whitespace-nowrap"},ge={class:"p-3 text-center"},ve={key:0},ye={key:1,class:"italic text-gray-400"},xe={class:"p-3 text-center"},be={class:"flex items-center justify-center gap-3"},ke=["onClick"],_e=["onClick"],he={key:0,class:"mb-3 text-xs text-blue-600"},Se={class:"space-y-4 text-sm"},we={key:0,class:"text-sm text-red-500"},Ce=["disabled"],Be={key:0,class:"text-sm text-red-500"},Me=["disabled"],Te={key:0,class:"text-sm text-red-500"},De=["disabled"],Ve={key:0,class:"text-sm text-red-500"},$e={class:"text-sm"},je={key:0,class:"text-gray-600"},Ee={components:{SortIcon:{props:{active:Boolean,direction:String},template:`
                <span class="inline-block ml-2 text-xs">
                    <template v-if="active">
                        {{ direction === 'asc' ? 'â–²' : 'â–¼' }}
                    </template>
                    <template v-else>
                        â‡…
                    </template>
                </span>
            `}}},ze=Object.assign(Ee,{layout:vt},{__name:"Index",props:{user:{type:String,required:!0},itemStocks:{type:Object,required:!0},items:{type:Array,required:!0},branches:{type:Array,required:!0},filters:{type:Object,default:()=>({})},sortBy:{type:String,default:"created_at"},sortDirection:{type:String,default:"desc"},groupBy:{type:String,default:null},isSuperadmin:{type:Boolean,default:!1}},setup(d){const{user:Y,can:v}=bt(),Z=[{label:"Penyimpanan"},{label:"Stok Masuk"}],m=d,c=y({q:m.filters.q??"",branch_id:m.filters.branch_id??(m.isSuperadmin?null:Y?.employee?.branch_id??null),item_id:m.filters.item_id??null,date_from:m.filters.date_from??"",date_to:m.filters.date_to??""}),_=y(m.groupBy??""),V=F(()=>_.value||(m.groupBy??"")),O=F(()=>!!V.value),q=y(new Set),tt=F(()=>{if(!O.value)return{};const n=m.itemStocks.data||[],e={};for(const b of n){const s=et(b);e[s]||(e[s]=[]),e[s].push(b)}return e});function et(n){switch(V.value){case"created_at":return n.created_at??"Tanggal Masuk";case"item":return n.item.name;default:return"ungrouped"}}function st(n){switch(V.value){case"created_at":return`Tanggal Masuk: ${n}`;case"item":return`Nama Barang: ${n}`;default:return n}}function H(n){return q.value.has(n)}function nt(n){const e=new Set(q.value);e.has(n)?e.delete(n):e.add(n),q.value=e}function x({sortBy:n=m.sortBy,sortDirection:e=m.sortDirection}={}){J.get(route("stock-in.index"),{...c.value,groupBy:V.value||null,sortBy:n,sortDirection:e},{preserveScroll:!0,preserveState:!0,replace:!0,onStart:()=>{typeof window<"u"&&(window.__suppressProgress=!0)},onFinish:()=>{typeof window<"u"&&(window.__suppressProgress=!1)}})}let G;N(()=>c.value.q,()=>{clearTimeout(G),G=setTimeout(()=>x({}),400)}),N(()=>[c.value.branch_id,c.value.item_id,c.value.date_from,c.value.date_to],()=>x({})),N(_,()=>x({})),N(()=>m.groupBy,n=>{!_.value&&n&&(_.value=n)});function M(n){const e=m.sortBy===n&&m.sortDirection==="asc"?"desc":"asc";x({sortBy:n,sortDirection:e})}function at(){c.value={q:"",branch_id:null,item_id:null,date_from:"",date_to:"",status:""},_.value="",x({})}const w=y(!1),T=y(!1),p=y(!1),ot=y(!1),P=y("update"),D=y(!1),$=y("");let j=null;const a=pt({id:null,item_id:null,amount:null,tanggal:new Date().toISOString().split("T")[0],note:""});function E(n,e){a.setError(n,e)}function A(){a.clearErrors()}function lt(){A();let n=!0;return a.item_id||(E("item_id","Barang wajib dipilih."),n=!1),(a.amount===null||a.amount===""||Number(a.amount)<=0)&&(E("amount","Qty harus lebih besar dari 0."),n=!1),a.tanggal&&isNaN(new Date(a.tanggal).getTime())&&(E("tanggal","Tanggal tidak valid."),n=!1),a.note&&String(a.note).length>500&&(E("note","Catatan maksimal 500 karakter."),n=!1),n}function it(){v("stock_in.create")&&(w.value=!0,T.value=!1,a.reset(),A(),a.tanggal=new Date().toISOString().split("T")[0])}function I(n){v("stock_in.edit")&&(w.value=!0,T.value=!0,A(),a.id=n.id,a.item_id=n.item_id??n.item?.id??null,a.amount=n.amount,a.tanggal=n.tanggal??new Date().toISOString().split("T")[0],a.note=n.note||"")}function rt(){a.processing||p.value||(w.value=!1,T.value=!1,a.reset(),A())}function z(){j=z,a.put(route("stock-in.update",a.id),{onStart:()=>{p.value=!0},onSuccess:()=>{w.value=!1,P.value="update",ot.value=!0,x({})},onError:n=>{(!n||Object.keys(n).length===0)&&($.value="Tidak dapat terhubung ke server.",D.value=!0)},onFinish:()=>{p.value=!1},preserveScroll:!0,preserveState:!0,replace:!0})}function Q(){j=Q,a.post(route("stock-in.store"),{onStart:()=>{p.value=!0},onSuccess:()=>{w.value=!1,P.value="create",a.reset(),x({})},onError:n=>{(!n||Object.keys(n).length===0)&&($.value="Tidak dapat terhubung ke server.",D.value=!0)},onFinish:()=>{p.value=!1},preserveScroll:!0,preserveState:!0,replace:!0})}function dt(){if(!(a.processing||p.value)&&lt())if(T.value){if(!v("stock_in.edit"))return;z()}else{if(!v("stock_in.create"))return;Q()}}function ut(){D.value=!1,typeof j=="function"&&j()}function K(n){v("stock_in.delete")&&confirm("Apakah Anda yakin ingin menghapus data ini?")&&J.delete(route("stock-in.destroy",n),{onSuccess:()=>{x({})}})}return(n,e)=>{const b=ft("SortIcon");return i(),l(B,null,[f(r(gt),{title:"Stok Masuk"}),t("div",kt,[t("div",_t,[f(yt,{items:Z}),r(v)("stock_in.create")?(i(),l("button",{key:0,onClick:it,type:"button",class:"inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-white bg-blue-500 border rounded-md hover:text-blue-500 hover:border-gray-300"}," Tambah Data ")):g("",!0)]),t("div",ht,[t("div",St,[e[17]||(e[17]=t("div",{class:"font-bold text-gray-700 md:text-xl"},"Daftar Stok Masuk",-1)),t("div",wt,[f(R,{modelValue:c.value.branch_id,"onUpdate:modelValue":e[0]||(e[0]=s=>c.value.branch_id=s),label:"Pilih cabang",class:"w-56",items:d.branches},{item:L(({item:s})=>[t("span",null,o(s.name),1)]),_:1},8,["modelValue","items"]),k(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>_.value=s),class:"h-10 px-3 text-sm border border-gray-200 rounded-lg"},[...e[16]||(e[16]=[t("option",{value:""},"Kelompokan Berdasarkan",-1),t("option",{value:"item"},"Group: Nama Barang",-1),t("option",{value:"created_at"},"Group: Tanggal Masuk",-1)])],512),[[W,_.value]])])]),t("div",Ct,[t("table",Bt,[t("thead",null,[t("tr",null,[e[23]||(e[23]=t("th",{class:"py-2.5 bg-gray-100 border-y"},[t("div",{class:"px-3 font-medium"},"No.")],-1)),t("th",Mt,[t("button",{onClick:e[2]||(e[2]=s=>M("id")),class:"w-full px-3 font-medium text-center text-gray-600"},[e[18]||(e[18]=S(" No. Referensi ",-1)),f(b,{active:d.sortBy==="id",direction:d.sortDirection},null,8,["active","direction"])])]),e[24]||(e[24]=t("th",{class:"py-2.5 bg-gray-100 border-y"},[t("div",{class:"w-full px-3 font-medium text-center text-gray-600"}," Nama Barang ")],-1)),t("th",Tt,[t("button",{onClick:e[3]||(e[3]=s=>M("initial_stock")),class:"w-full px-3 font-medium text-center text-gray-600"},[e[19]||(e[19]=S(" Stok Sebelumnya ",-1)),f(b,{active:d.sortBy==="initial_stock",direction:d.sortDirection},null,8,["active","direction"])])]),t("th",Dt,[t("button",{onClick:e[4]||(e[4]=s=>M("amount")),class:"w-full px-3 font-medium text-gray-600"},[e[20]||(e[20]=S(" Qty ",-1)),f(b,{active:d.sortBy==="amount",direction:d.sortDirection},null,8,["active","direction"])])]),t("th",Vt,[t("button",{onClick:e[5]||(e[5]=s=>M("last_stock")),class:"w-full px-3 font-medium text-gray-600"},[e[21]||(e[21]=S(" Stok Akhir ",-1)),f(b,{active:d.sortBy==="last_stock",direction:d.sortDirection},null,8,["active","direction"])])]),t("th",$t,[t("button",{onClick:e[6]||(e[6]=s=>M("created_at")),class:"w-full px-3 font-medium text-center text-gray-600"},[e[22]||(e[22]=S(" Tanggal Masuk ",-1)),f(b,{active:d.sortBy==="created_at",direction:d.sortDirection},null,8,["active","direction"])])]),e[25]||(e[25]=t("th",{class:"py-2.5 bg-gray-100 border-y"},[t("div",{class:"px-3 font-medium text-gray-600"},"Catatan")],-1)),e[26]||(e[26]=t("th",{class:"py-2.5 bg-gray-100 border-y"},[t("div",{class:"px-3 font-medium text-gray-600"},"Aksi")],-1))]),t("tr",null,[t("th",jt,[t("div",Et,[k(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>c.value.q=s),type:"text",placeholder:"Cari nomor referensi",class:"py-2.5 pr-12 pl-4 w-full text-sm rounded-lg border border-gray-200"},null,512),[[C,c.value.q]]),e[27]||(e[27]=t("span",{class:"absolute text-gray-400 -translate-y-1/2 right-3 top-1/2"},"ðŸ”",-1))])]),t("th",At,[k(t("select",{"onUpdate:modelValue":e[8]||(e[8]=s=>c.value.item_id=s),class:"w-full px-3 text-xs border-gray-300 rounded"},[e[28]||(e[28]=t("option",{value:null},"Semua",-1)),(i(!0),l(B,null,U(d.items,s=>(i(),l("option",{key:s.id,value:s.id},o(s.name),9,Nt))),128))],512),[[W,c.value.item_id]])]),t("th",Ut,[t("div",qt,[k(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>c.value.date_from=s),type:"date",class:"h-10 text-xs border-gray-300 rounded w-36"},null,512),[[C,c.value.date_from]]),k(t("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>c.value.date_to=s),type:"date",class:"h-10 text-xs border-gray-300 rounded w-36"},null,512),[[C,c.value.date_to]])])]),e[29]||(e[29]=t("th",{class:"px-2 py-2 bg-gray-50 border-y"},null,-1)),t("th",{class:"px-2 py-2 bg-gray-50 border-y"},[t("button",{onClick:at,class:"px-3 py-2 text-xs text-white bg-red-500 rounded"},"Clear")])])]),t("tbody",null,[!d.itemStocks.data||d.itemStocks.data.length===0?(i(),l("tr",Ft,[...e[30]||(e[30]=[t("td",{colspan:"9",class:"py-8 text-center text-gray-500"},"Stok masuk tidak ditemukan.",-1)])])):O.value?(i(!0),l(B,{key:1},U(tt.value,(s,h)=>(i(),l(B,{key:h},[t("tr",null,[t("td",Lt,[t("button",{class:"inline-flex items-center gap-2",onClick:u=>nt(h)},[t("span",Ht,o(H(h)?"â–¶":"â–¼"),1),t("span",null,o(st(h)),1),t("span",Gt,"("+o(s.length)+")",1)],8,Ot)])]),H(h)?g("",!0):(i(!0),l(B,{key:0},U(s,(u,ct)=>(i(),l("tr",{key:u.id,class:"border-b border-gray-200"},[t("td",Pt,o(ct+(d.itemStocks.current_page-1)*d.itemStocks.per_page+1)+".",1),t("td",It,[u.reference_no?(i(),l("span",zt,o(u.reference_no),1)):(i(),l("span",Qt,"Manual"))]),t("td",Kt,o(u.item.name),1),t("td",Wt,o(u.initial_stock)+" "+o(u.item.unit?.name),1),t("td",Jt,"+ "+o(u.amount)+" "+o(u.item.unit?.name),1),t("td",Rt,o(u.last_stock)+" "+o(u.item.unit?.name),1),t("td",Xt,o(u.created_at),1),t("td",Yt,[u.note&&u.note.trim()?(i(),l("span",Zt,o(u.note),1)):(i(),l("span",te,"â€”"))]),t("td",ee,[t("div",se,[r(v)("stock_in.edit")?(i(),l("button",{key:0,onClick:mt=>I(u),class:"text-yellow-500 hover:text-yellow-600",title:"Edit"},[...e[31]||(e[31]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,ne)):g("",!0),r(v)("stock_in.delete")?(i(),l("button",{key:1,onClick:mt=>K(u.id),class:"text-red-500 hover:text-red-600",title:"Hapus"},[...e[32]||(e[32]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,ae)):g("",!0)])])]))),128))],64))),128)):(i(!0),l(B,{key:2},U(d.itemStocks.data,(s,h)=>(i(),l("tr",{key:s.id,class:"border-b border-gray-200"},[t("td",oe,o(h+(d.itemStocks.current_page-1)*d.itemStocks.per_page+1)+".",1),t("td",le,[s.reference_no?(i(),l("span",ie,o(s.reference_no),1)):(i(),l("span",re,"Manual"))]),t("td",null,[t("div",de,[t("span",ue,o(s.item.name),1)])]),t("td",ce,o(s.initial_stock)+" "+o(s.item.unit?.name),1),t("td",me,"+ "+o(s.amount)+" "+o(s.item.unit?.name),1),t("td",pe,o(s.last_stock)+" "+o(s.item.unit?.name),1),t("td",fe,o(s.created_at),1),t("td",ge,[s.note&&s.note.trim()?(i(),l("span",ve,o(s.note),1)):(i(),l("span",ye,"â€”"))]),t("td",xe,[t("div",be,[r(v)("stock_in.edit")?(i(),l("button",{key:0,onClick:u=>I(s),class:"text-yellow-500 hover:text-yellow-600",title:"Edit"},[...e[33]||(e[33]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,ke)):g("",!0),r(v)("stock_in.delete")?(i(),l("button",{key:1,onClick:u=>K(s.id),class:"text-red-500 hover:text-red-600",title:"Hapus"},[...e[34]||(e[34]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,_e)):g("",!0)])])]))),128))])]),f(xt,{pagination:d.itemStocks,class:"border-t"},null,8,["pagination"])]),f(X,{show:w.value,title:T.value?"Edit Stok Masuk":"Tambah Stok Masuk",confirmText:p.value?"Menyimpan...":"Simpan",maxWidth:"md",onClose:rt,onConfirm:dt},{default:L(()=>[p.value?(i(),l("div",he,"Menyimpan, mohon tungguâ€¦")):g("",!0),t("div",Se,[t("div",null,[e[35]||(e[35]=t("label",{class:"font-semibold text-gray-900"},[S("Barang "),t("span",{class:"text-red-500"},"*")],-1)),f(R,{modelValue:r(a).item_id,"onUpdate:modelValue":e[11]||(e[11]=s=>r(a).item_id=s),items:d.items,label:"Pilih barang",disabled:r(a).processing||p.value,class:"w-full mt-1",isSuperadmin:d.isSuperadmin},null,8,["modelValue","items","disabled","isSuperadmin"]),r(a).errors.item_id?(i(),l("div",we,o(r(a).errors.item_id),1)):g("",!0)]),t("div",null,[e[36]||(e[36]=t("label",{class:"font-semibold text-gray-900"},[S("Qty "),t("span",{class:"text-red-500"},"*")],-1)),k(t("input",{"onUpdate:modelValue":e[12]||(e[12]=s=>r(a).amount=s),type:"number",step:"0.0001",min:"0",disabled:r(a).processing||p.value,class:"w-full mt-1 text-sm border-gray-400 rounded",placeholder:"Masukkan jumlah"},null,8,Ce),[[C,r(a).amount,void 0,{number:!0}]]),r(a).errors.amount?(i(),l("div",Be,o(r(a).errors.amount),1)):g("",!0)]),t("div",null,[e[37]||(e[37]=t("label",{class:"font-semibold text-gray-900"},"Tanggal",-1)),k(t("input",{"onUpdate:modelValue":e[13]||(e[13]=s=>r(a).tanggal=s),type:"date",disabled:r(a).processing||p.value,class:"w-full mt-1 text-sm border-gray-400 rounded"},null,8,Me),[[C,r(a).tanggal]]),r(a).errors.tanggal?(i(),l("div",Te,o(r(a).errors.tanggal),1)):g("",!0)]),t("div",null,[e[38]||(e[38]=t("label",{class:"font-semibold text-gray-900"},"Catatan",-1)),k(t("textarea",{"onUpdate:modelValue":e[14]||(e[14]=s=>r(a).note=s),rows:"3",disabled:r(a).processing||p.value,class:"w-full mt-1 text-sm border-gray-400 rounded",placeholder:"Catatan (opsional)"},null,8,De),[[C,r(a).note]]),r(a).errors.note?(i(),l("div",Ve,o(r(a).errors.note),1)):g("",!0)])])]),_:1},8,["show","title","confirmText"]),f(X,{show:D.value,title:"Terjadi Kesalahan",confirmText:"Coba Lagi",maxWidth:"sm",onClose:e[15]||(e[15]=s=>D.value=!1),onConfirm:ut},{default:L(()=>[t("div",$e,[e[39]||(e[39]=t("div",{class:"mb-2 text-red-600"},"Gagal menyimpan data. Periksa koneksi internet Anda lalu coba lagi.",-1)),$.value?(i(),l("div",je,o($.value),1)):g("",!0)])]),_:1},8,["show"])])])],64)}}});export{ze as default};
