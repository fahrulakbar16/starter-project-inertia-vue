import{d as w,u as N,l as O,x as q,z as R,e as u,o as m,b as p,a as t,g as y,D as T,t as _,f as x,E as b,J as $,F as S,i as F,G as h,n as P,H as M}from"./app-CJkCV51W.js";import{_ as L}from"./AppLayout-BlEKf3Fz.js";import{_ as J}from"./Breadcrumb-BJQpsGcc.js";import W from"./CreateReceiptForm-B58NC3gO.js";import z from"./CreateTranferForm-CNYni9Aa.js";import{T as G}from"./TrashIcon-DSAHmBPH.js";import{_ as H}from"./SelectBarang-CRvJrPbK.js";import{v as j}from"./v4-BKrj-4V8.js";import"./FlashMessage-D4C-FUm8.js";import"./LayoutShell-FWpWJLvi.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useAuth-DvuTgkfF.js";import"./LayoutShell.vue_vue_type_style_index_0_lang-CRqqKi3W.js";import"./SelectPemakaian-bo5sz744.js";const K={class:"flex overflow-hidden flex-col gap-3 px-3 h-full"},Q={class:"flex justify-between items-center h-10"},X={class:"space-y-5 overflow-hidden rounded-lg border border-gray-200 bg-white p-6 dark:border-gray-700 dark:bg-white/[0.03]"},Y={class:"flex items-center justify-between"},Z={class:"font-bold text-sky-400 md:text-xl px-7"},ee={class:"space-y-5"},te={class:"space-y-2 m-5"},ae={key:0},re={key:1},de={class:"overflow-hidden rounded-lg border border-gray-200 bg-white dark:border-gray-700 dark:bg-white/[0.03]"},ie={class:"overflow-x-auto","data-simplebar":""},ne={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700 text-sm"},oe={class:"bg-white dark:bg-transparent"},se={class:"py-2.5 px-3 text-center align-middle border-b border-gray-200 dark:border-gray-700"},le={class:"py-2.5 px-3 align-middle border-b border-gray-200 dark:border-gray-700"},ce={class:"py-2.5 px-3 align-middle border-b border-gray-200 dark:border-gray-700"},ue={class:"flex items-center gap-2 justify-center"},me=["onUpdate:modelValue"],pe={class:"text-gray-700 dark:text-gray-300"},ye={class:"py-2.5 px-3 align-middle border-b border-gray-200 dark:border-gray-700"},ge={class:"flex items-center gap-2 justify-center"},_e=["onUpdate:modelValue"],be={class:"text-gray-700 dark:text-gray-300"},ve={class:"py-2.5 px-3 align-middle border-b border-gray-200 dark:border-gray-700"},xe={class:"relative"},he=["onUpdate:modelValue","placeholder"],fe={key:0,class:"absolute -top-6 left-0 text-xs text-red-500 whitespace-nowrap"},ke={class:"py-2.5 px-3 align-middle border-b border-gray-200 dark:border-gray-700"},we=["onUpdate:modelValue"],qe={class:"py-2.5 px-3 text-center align-middle border-b border-gray-200 dark:border-gray-700"},Re=["onClick"],je={key:0,class:"px-6 py-3 text-xs text-rose-600"},Ie={class:"flex items-center gap-5 justify-end"},Se=["disabled"],Le=Object.assign({layout:L},{__name:"Edit",props:{goodReceipt:{type:Object,required:!0},user:Object,employees:{type:Array,required:!0},items:{type:Array,default:()=>[]},order:{type:Array,required:!0},transfer:{type:Array,required:!0},departments:{type:Array,required:!0},isSuperadmin:{type:Boolean,required:!0}},setup(s){const U=[{label:"Penyimpanan"},{label:"Penerimaan Barang",href:route("good-receipts.index")},{label:"Edit Penerimaan"}],l=w("pembelian"),d=s,v=w(d.items.map(e=>({id:e.id,name:e.name,code:e.code,unit:e.unit}))),B=e=>{const r=n.value.map((a,c)=>c!==e?a.item_id:null).filter(a=>a&&typeof a=="object"&&a.id).map(a=>a.id);return v.value.filter(a=>!r.includes(a.id))},g=e=>e.quantity_received!==e.quantity_actually_received,f=()=>n.value.every(e=>g(e)?e.received_note&&e.received_note.trim()!=="":!0);function C(e){const r={id:Date.now(),name:e,code:"-"};return v.value.push(r),r}function k(e){R(()=>e.item_id,r=>{if(r){if(typeof r=="object"&&r!==null)e.code=r.code,e.name=r.name,e.unit=r.unit;else if(typeof r=="string"){const a=C(r);e.item_id=a,e.code=a.code,e.name=a.name,e.unit=a.unit}}else e.code="",e.name="",e.unit={}},{immediate:!0})}const n=w([]),V=()=>{const e=q({uid:j(),item_id:null,quantity_received:1,quantity_actually_received:0,code:"",name:"",unit:{},note:"",received_note:""});k(e),n.value.push(e)},D=e=>{n.value.splice(e,1)},i=N({employee_id:d.goodReceipt.employee_id,order_id:d.goodReceipt.order_id,transfer_id:d.goodReceipt.transfer_id,source:d.goodReceipt.source,note:d.goodReceipt.note,received_at:d.goodReceipt.received_at?new Date(d.goodReceipt.received_at).toISOString().slice(0,10):new Date().toISOString().slice(0,10),items:[]});function I(e){if(!e||e.length===0){e.value=[];return}e.value=e.map(r=>{const a=q({uid:j(),item_id:v.value.find(c=>c.id===r.item_id)??null,code:r.code,name:r.name,unit:r.unit,quantity_received:r.quantity_received,quantity_actually_received:r.quantity_received,note:r.note,received_note:""});return k(a),a})}O(()=>{l.value=d.goodReceipt.source==="Pembelian"?"pembelian":"pemindahan",d.goodReceipt.items&&d.goodReceipt.items.length>0&&(n.value=d.goodReceipt.items.map(e=>{const r=q({uid:j(),item_id:v.value.find(a=>a.id===e.item_id)??null,code:e.item?.code||"",name:e.item?.name||"",unit:e.item?.unit||{},quantity_received:e.quantity_received,quantity_actually_received:e.quantity_actually_received||e.quantity_received,note:e.note||"",received_note:e.received_note||""});return k(r),r}))}),R(()=>i.order_id,e=>{if(!e||l.value!=="pembelian"){n.value=[];return}}),R(()=>i.transfer_id,e=>{if(!e||l.value!=="pemindahan"){n.value=[];return}});function E(){if(!f()&&n.value.filter(r=>g(r)&&(!r.received_note||r.received_note.trim()==="")).length>0){alert("Mohon lengkapi catatan penerimaan untuk item yang jumlah diterima tidak sama dengan jumlah barang.");return}i.items=n.value.map(e=>({uid:e.uid,item_id:e.item_id?.id??null,quantity_received:e.quantity_received,quantity_actually_received:e.quantity_actually_received,note:e.note??null,received_note:e.received_note??null})),l.value==="pembelian"?i.transfer_id=null:i.order_id=null,i.put(route("good-receipts.update",d.goodReceipt.id))}function A(){M.get(route("good-receipts.index"))}return(e,r)=>(m(),u(S,null,[p(y(T),{title:l.value==="pembelian"?"Edit Penerimaan Barang (Pembelian)":"Edit Penerimaan Barang (Pemindahan)"},null,8,["title"]),t("div",K,[t("div",Q,[p(J,{items:U})]),t("div",X,[t("div",Y,[r[1]||(r[1]=t("div",{class:"font-bold text-gray-700 md:text-xl dark:text-gray-300 m-5"}," Form Ubah Penerimaan Barang ",-1)),t("div",Z,_(y(i).source),1)]),t("div",ee,[t("div",te,[r[3]||(r[3]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," Sumber Penerimaan ",-1)),b(t("select",{"onUpdate:modelValue":r[0]||(r[0]=a=>l.value=a),class:"h-10 px-3 w-full border border-gray-300 rounded-md text-sm dark:border-gray-700 dark:bg-gray-800 dark:text-white/90",disabled:!0},[...r[2]||(r[2]=[t("option",{value:"pembelian"},"Pembelian",-1),t("option",{value:"pemindahan"},"Pemindahan",-1)])],512),[[$,l.value]])]),l.value==="pembelian"?(m(),u("div",ae,[p(W,{form:y(i),orders:s.order,employees:s.employees,user:s.user,onItemsLoaded:I,isSuperadmin:s.isSuperadmin,isEdit:!0},null,8,["form","orders","employees","user","isSuperadmin"])])):x("",!0),l.value==="pemindahan"?(m(),u("div",re,[p(z,{form:y(i),transfers:s.transfer,employees:s.employees,user:s.user,onItemsLoaded:I,isSuperadmin:s.isSuperadmin,isEdit:!0},null,8,["form","transfers","employees","user","isSuperadmin"])])):x("",!0)])]),t("div",de,[r[5]||(r[5]=t("div",{class:"flex items-center justify-between px-6 py-4"},[t("div",{class:"font-semibold text-gray-700 dark:text-gray-200"}," Daftar Item ")],-1)),t("div",ie,[t("table",ne,[r[4]||(r[4]=t("thead",{class:"bg-gray-100 dark:bg-gray-800"},[t("tr",null,[t("th",{class:"py-2.5 px-3 text-center font-medium text-gray-500 dark:text-gray-400 whitespace-nowrap"}," No. "),t("th",{class:"py-2.5 px-3 text-center font-medium text-gray-500 dark:text-gray-400 whitespace-nowrap"}," Nama Barang "),t("th",{class:"py-2.5 px-3 text-center font-medium text-gray-500 dark:text-gray-400 whitespace-nowrap"}," Jumlah barang "),t("th",{class:"py-2.5 px-3 text-center font-medium text-gray-500 dark:text-gray-400 whitespace-nowrap"}," Jumlah Diterima "),t("th",{class:"py-2.5 px-3 text-center font-medium text-gray-500 dark:text-gray-400 whitespace-nowrap"}," Catatan Diterima "),t("th",{class:"py-2.5 px-3 text-center font-medium text-gray-500 dark:text-gray-400 whitespace-nowrap"}," Catatan "),t("th",{class:"py-2.5 px-3 text-center font-medium text-gray-500 dark:text-gray-400 whitespace-nowrap"}," Aksi ")])],-1)),t("tbody",oe,[(m(!0),u(S,null,F(n.value,(a,c)=>(m(),u("tr",{key:a.uid,class:"hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"},[t("td",se,_(c+1),1),t("td",le,[p(H,{modelValue:a.item_id,"onUpdate:modelValue":o=>a.item_id=o,items:B(c),taggable:!0,label:"Cari Barang","label-key":"name","search-key":"name"},null,8,["modelValue","onUpdate:modelValue","items"])]),t("td",ce,[t("div",ue,[b(t("input",{"onUpdate:modelValue":o=>a.quantity_received=o,type:"number",min:"0",class:"w-24 rounded border-gray-300 dark:border-gray-700 dark:bg-gray-800 dark:text-white/90"},null,8,me),[[h,a.quantity_received]]),t("span",pe,_(a.unit?.short_name),1)])]),t("td",ye,[t("div",ge,[b(t("input",{"onUpdate:modelValue":o=>a.quantity_actually_received=o,type:"number",min:"0",placeholder:"0",class:"w-24 rounded border-gray-300 dark:border-gray-700 dark:bg-gray-800 dark:text-white/90"},null,8,_e),[[h,a.quantity_actually_received]]),t("span",be,_(a.unit?.short_name),1)])]),t("td",ve,[t("div",xe,[b(t("input",{"onUpdate:modelValue":o=>a.received_note=o,type:"text",placeholder:g(a)?"Catatan penerimaan (Wajib diisi)":"Catatan penerimaan",class:P(["w-40 h-10 text-sm rounded placeholder:text-gray-600 dark:bg-gray-800 dark:text-white/90",g(a)&&(!a.received_note||a.received_note.trim()==="")?"border-red-500 focus:border-red-500 focus:ring-red-500":"border-gray-300 dark:border-gray-700"])},null,10,he),[[h,a.received_note]]),g(a)&&(!a.received_note||a.received_note.trim()==="")?(m(),u("span",fe," Wajib diisi ")):x("",!0)])]),t("td",ke,[b(t("input",{"onUpdate:modelValue":o=>a.note=o,type:"text",placeholder:"Masukkan catatan",class:"w-40 h-10 text-sm rounded placeholder:text-gray-600 border-gray-300 dark:border-gray-700 dark:bg-gray-800 dark:text-white/90"},null,8,we),[[h,a.note]])]),t("td",qe,[t("button",{onClick:o=>D(c),class:"focus:outline-none"},[p(G,{class:"text-red-500"})],8,Re)])]))),128)),t("button",{type:"button",onClick:V,class:"m-4 px-3 py-2 text-white bg-green-500 hover:bg-green-600 rounded whitespace-nowrap"}," + Tambah Item ")])])]),y(i).errors.items?(m(),u("div",je,_(y(i).errors.items[0]),1)):x("",!0)]),t("div",Ie,[t("button",{type:"button",onClick:A,class:"inline-flex items-center rounded border bg-gray-400 border-gray-300 px-5 py-2 text-sm text-white hover:text-gray-800 hover:bg-gray-300 dark:border-gray-700 dark:text-gray-300"}," Batal "),t("button",{onClick:E,disabled:!f(),class:P(["inline-flex items-center rounded px-4 py-2 text-sm font-medium text-white disabled:opacity-60",f()?"bg-blue-600 hover:bg-blue-700":"bg-gray-400 cursor-not-allowed"])}," Update Penerimaan ",10,Se)])])],64))}});export{Le as default};
