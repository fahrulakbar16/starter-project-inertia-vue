import{d as f,l as V,z as b,e as d,o as s,a,E as c,f as m,G as x,t as n,b as v,w as E,h as g,K as M,L as S}from"./app-CJkCV51W.js";import{_ as h}from"./SelectPemakaian-bo5sz744.js";const z={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},A={key:0,class:"mt-1 text-sm text-red-500"},B={key:0,class:"mt-1 text-sm text-red-500"},C={key:0,class:"mt-1 text-xs text-blue-600 dark:text-blue-400"},T={key:1,class:"mt-1 text-xs text-rose-600"},N={key:0,class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},j={key:1,class:"mt-1 text-xs text-blue-600 dark:text-blue-400"},O={key:2,class:"mt-1 text-xs text-blue-600 dark:text-blue-400"},U={key:3,class:"mt-1 text-xs text-rose-600"},H={key:4,class:"mt-1 text-xs text-rose-600"},$={class:"col-span-2"},D={key:0,class:"mt-1 text-xs text-rose-600"},K={__name:"Form",props:{form:{type:Object,required:!0},departments:{type:Array,required:!0},employees:{type:Array,required:!0},user:{type:Object,required:!0},isEdit:{type:Boolean,required:!0}},emits:["submit","cancel","department-changed"],setup(r,{emit:q}){const t=r,w=q;console.log("form department_id:",t.form.department_id);const i=t.user?.roles?.[0]?.name==="Superadmin",u=f([...t.employees]),y=f(!1),p=f(""),k=async o=>{if(console.log(o),!o){u.value="",p.value="";return}try{y.value=!0,p.value="";const e=await S.get(route("departments.employees",o),{headers:{Accept:"application/json","Content-Type":"application/json"}});e.data&&Array.isArray(e.data)?u.value=e.data.map(l=>({id:l.id,name:l.name,email:l.user?.email||""})):(u.value=[],p.value="Tidak ada karyawan ditemukan untuk departemen ini"),t.form.employee_id=null}catch(e){console.error("Error fetching employees:",e),u.value=[],p.value="Gagal memuat data karyawan. Silakan coba lagi."}finally{y.value=!1}};return V(()=>{console.log("Form mounted - User data:",t.user),console.log("User employee:",t.user?.employee),console.log("Is Superadmin:",i),!i&&t.user?.employee&&(console.log("Auto-populating fields for non-Superadmin user"),t.user.employee.department_id&&(t.form.department_id=t.isEdit?t.form.department_id:t.user.employee.department_id,console.log("Set department_id to:",t.form.department_id)),t.user.employee.id&&(t.form.employee_id=t.isEdit?t.form.employee_id:t.user.employee.id,console.log("Set employee_id to:",t.form.employee_id)))}),b(()=>t.user,o=>{console.log("User data changed:",o),console.log("isSuperadmin:",i),!i&&o?.employee&&(o.employee.department_id&&!t.form.department_id&&(t.form.department_id=o.employee.department_id,console.log("Updated department_id to:",t.form.department_id),k(o.employee.department_id)),o.employee.id&&!t.form.employee_id&&(t.form.employee_id=o.employee.id,console.log("Updated employee_id to:",t.form.employee_id)))},{deep:!0}),b(()=>t.form.department_id,(o,e)=>{o!==e&&(console.log("Department changed to:",o),k(o),w("department-changed",o))}),(o,e)=>(s(),d("form",{onSubmit:e[5]||(e[5]=M(l=>o.$emit("submit"),["prevent"])),class:"space-y-4"},[a("div",z,[a("div",null,[e[6]||(e[6]=a("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"No. Request",-1)),c(a("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>r.form.request_no=l),type:"text",disabled:"",class:"h-10 p-0 w-full border-0 border-b-2 border-gray-300 dark:border-gray-700 dark:bg-gray-800 dark:text-white/90"},null,512),[[x,r.form.request_no]]),r.form.errors.request_no?(s(),d("p",A,n(r.form.errors.request_no[0]),1)):m("",!0)]),a("div",null,[e[7]||(e[7]=a("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Tanggal Permintaan",-1)),c(a("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>r.form.requested_at=l),type:"date",class:"h-10 ps-0 pe-5 w-full border-0 border-b-2 border-gray-300 dark:border-gray-700 dark:bg-gray-800 dark:text-white/90"},null,512),[[x,r.form.requested_at]]),r.form.errors.requested_at?(s(),d("p",B,n(r.form.errors.requested_at[0]),1)):m("",!0)]),a("div",null,[e[9]||(e[9]=a("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Departemen",-1)),v(h,{modelValue:r.form.department_id,"onUpdate:modelValue":e[2]||(e[2]=l=>r.form.department_id=l),items:r.departments,disabled:!i,class:"mt-2"},{item:E(({item:l})=>[a("span",null,n(l.name)+n(l.branch?" - "+l.branch.name:""),1)]),_:1},8,["modelValue","items","disabled"]),!i&&r.form.department_id?(s(),d("p",C,[...e[8]||(e[8]=[a("svg",{class:"inline w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20"},[a("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})],-1),g(" Otomatis diisi berdasarkan data karyawan Anda ",-1)])])):m("",!0),r.form.errors.department_id?(s(),d("p",T,n(r.form.errors.department_id[0]),1)):m("",!0)]),a("div",null,[e[12]||(e[12]=a("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Permintaan oleh",-1)),v(h,{modelValue:r.form.employee_id,"onUpdate:modelValue":e[3]||(e[3]=l=>r.form.employee_id=l),items:u.value,disabled:!i||y.value,class:"mt-2"},null,8,["modelValue","items","disabled"]),!y.value&&u.value.length===0&&r.form.department_id?(s(),d("div",N," Tidak ada karyawan tersedia untuk departemen ini ")):m("",!0),y.value?(s(),d("div",j,[...e[10]||(e[10]=[a("svg",{class:"inline w-3 h-3 mr-1 animate-spin",fill:"none",viewBox:"0 0 24 24"},[a("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),a("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),g(" Memuat data karyawan... ",-1)])])):m("",!0),!i&&r.form.employee_id&&!y.value?(s(),d("p",O,[...e[11]||(e[11]=[a("svg",{class:"inline w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20"},[a("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})],-1),g(" Otomatis diisi berdasarkan data karyawan Anda ",-1)])])):m("",!0),p.value?(s(),d("p",U,n(p.value),1)):m("",!0),r.form.errors.employee_id?(s(),d("p",H,n(r.form.errors.employee_id[0]),1)):m("",!0)]),a("div",$,[e[13]||(e[13]=a("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Keperluan",-1)),c(a("textarea",{"onUpdate:modelValue":e[4]||(e[4]=l=>r.form.requirement=l),rows:"2",placeholder:"Masukkan keperluan permintaan barang",class:"mt-1 w-full rounded-md text-sm border-gray-300 placeholder:text-gray-400 dark:border-gray-700 dark:bg-gray-800 dark:text-white/90"},null,512),[[x,r.form.requirement]]),r.form.errors.requirement?(s(),d("p",D,n(r.form.errors.requirement[0]),1)):m("",!0)])])],32))}};export{K as default};
