import{R as I,u as J,d as E,z as T,H as O,e as n,o as u,b as v,a as e,g as a,D as L,E as m,f as x,G as f,n as k,t as b,J as j,F as S,i as M,h as B,N as H,S as R}from"./app-CJkCV51W.js";import{_ as W}from"./AppLayout-BlEKf3Fz.js";import{_ as G}from"./Breadcrumb-BJQpsGcc.js";import{_ as U}from"./Select-D-70zGQm.js";import{s as X}from"./index-BE-zAuZ8.js";import{v as P}from"./v4-BKrj-4V8.js";import"./FlashMessage-D4C-FUm8.js";import"./LayoutShell-FWpWJLvi.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useAuth-DvuTgkfF.js";import"./LayoutShell.vue_vue_type_style_index_0_lang-CRqqKi3W.js";import"./index-BD4Vkpl0.js";import"./index-jsubnK9F.js";import"./index-GHgtZDXu.js";const Y={class:"flex overflow-hidden flex-col gap-3 px-3 py-0.5 h-full"},Z={class:"flex justify-between items-center h-10"},q={class:"flex overflow-hidden flex-col bg-white rounded-lg border border-gray-200"},ee={class:"p-6 space-y-4"},te={class:"grid grid-cols-1 gap-4 md:grid-cols-3"},se={key:0,class:"mt-1 text-xs text-red-500"},re={key:0,class:"mt-1 text-xs text-red-500"},ae={key:0,class:"mt-1 text-xs text-red-500"},oe={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},le={key:0,class:"mt-1 text-xs text-red-500"},ie={key:0,class:"mt-1 text-xs text-red-500"},de={class:"grid grid-cols-1 gap-4 mt-2 md:grid-cols-2"},ne={class:"md:col-span-2"},ue={key:0,class:"mt-1 text-xs text-red-500"},ce={key:0,class:"mt-1 text-xs text-red-500"},pe={class:"flex overflow-hidden flex-col bg-white rounded-lg border border-gray-200"},me={class:"p-6 space-y-4"},be={class:"space-y-4"},ye={class:"space-y-5"},ge={class:"grid grid-cols-12 gap-4"},xe={class:"col-span-12 md:col-span-1"},_e={class:"flex gap-3 items-center md:flex-col md:items-start"},he={class:"flex gap-2 items-center"},ve={class:"flex justify-center items-center w-8 h-8 text-sm font-medium text-gray-700 bg-gray-100 rounded-full border"},fe={class:"text-sm font-medium text-gray-700 md:hidden"},ke={class:"hidden text-sm font-medium text-gray-700 md:block"},we=["onClick"],Ve={class:"col-span-12 space-y-4 md:col-span-11"},Ce={class:"grid grid-cols-1 gap-4 lg:grid-cols-12"},Ue={class:"lg:col-span-8"},Pe={class:"relative z-0 w-full group"},je=["onUpdate:modelValue"],Se={class:"lg:col-span-4"},Ae={class:"inline-flex gap-2 items-center text-gray-800 cursor-pointer"},Ee=["onUpdate:modelValue"],Te={class:"grid grid-cols-1 gap-4 lg:grid-cols-12"},Oe={class:"lg:col-span-6"},Me={class:"relative z-0 w-full group"},$e=["onUpdate:modelValue"],De={class:"lg:col-span-3"},Ne={class:"lg:col-span-3"},ze=["onUpdate:modelValue","onChange"],Ke={key:0,class:"mt-4"},Fe={class:"overflow-x-auto"},Qe={class:"w-full text-sm rounded border border-gray-200"},Ie={class:"p-3 border-b border-gray-100"},Je=["onUpdate:modelValue"],Le={class:"p-3 border-b border-gray-100"},Be=["onUpdate:modelValue"],He={class:"p-3 text-center border-b border-gray-100"},Re=["onClick"],We=["onClick"],Ge={class:"flex justify-between items-center"},Xe=["disabled"],ct=Object.assign({layout:W},{__name:"Edit",props:{checklist:Object,categories:Array,departments:Array,types:Array,branches:Array,questionCategories:Array,questions:Array},setup(w){const d=w,$=[{label:"Konfigurasi"},{label:"Checklists",href:route("checklists.index")},{label:`Edit: ${d.checklist?.name||""}`}],y=I(),s=J({id:d.checklist?.id,name:d.checklist?.name||"",sop_code:d.checklist?.sop_code||"",category_id:d.checklist?.category_id||null,department_id:d.checklist?.department_id||null,branch_id:d.checklist?.branch_id||null,status:d.checklist?.status||"Draft",description:d.checklist?.description||"",type:d.checklist?.type||"single",questions:[]}),i=E({}),_=E((d.questions||[]).map(l=>{const t=["text","textarea","select","radio","checkbox"],r=l.answer_type&&t.includes(l.answer_type)?l.answer_type:"text";return{uid:l.uid||P(),id:l.id,title:l.title||"",description:l.description||"",answer_type:r,required:!!l.required,category:l.category||null,options:(l.options||[]).map(c=>({uid:c.uid||P(),label:c.label,value:c.value}))}}));function D(){_.value.push({uid:P(),title:"",description:"",answer_type:"text",required:!1,category:null,options:[]})}function N(l){["select","radio","checkbox"].includes(l.answer_type)||(l.options=[])}function z(l){_.value.splice(l,1)}function K(l){l.options.push({uid:P(),label:"",value:""})}function F(l,t){l.options.splice(t,1)}T(()=>s.branch_id,(l,t)=>{l!==t&&(s.department_id=null,l&&O.get(route("checklists.edit",d.checklist.id),{branch_id:l},{preserveState:!0,preserveScroll:!0,only:["departments"],replace:!0}))}),T(()=>s.department_id,(l,t)=>{if(l!==t&&l){const r=d.departments?.find(c=>c.id===l);r&&r.branch_id&&r.branch_id!==s.branch_id&&(s.branch_id=r.branch_id,O.get(route("checklists.edit",d.checklist.id),{branch_id:r.branch_id},{preserveState:!0,preserveScroll:!0,only:["departments"],replace:!0}))}});function Q(){i.value={};let l=!1;if(s.name||(i.value.name="Nama Checklist wajib diisi.",l=!0),s.sop_code||(i.value.sop_code="Nomor SOP wajib diisi.",l=!0),s.category_id||(i.value.category_id="Kategori Checklist wajib dipilih.",l=!0),s.branch_id||(i.value.branch_id="Cabang wajib dipilih.",l=!0),s.department_id||(i.value.department_id="Departemen wajib dipilih.",l=!0),l){y.add({severity:"error",summary:"Validasi Error",detail:"Mohon lengkapi semua field yang wajib diisi.",life:3e3});return}if(_.value.length===0){y.add({severity:"error",summary:"Error",detail:"Minimal harus ada satu pertanyaan.",life:4e3});return}if(_.value.filter(o=>!o.title.trim()).length>0){y.add({severity:"error",summary:"Error",detail:"Semua pertanyaan harus memiliki judul.",life:4e3});return}const r=["text","textarea","select","radio","checkbox"];if(_.value.filter(o=>!o.answer_type||!r.includes(o.answer_type)).length>0){y.add({severity:"error",summary:"Error",detail:"Semua pertanyaan harus memiliki tipe jawaban yang valid.",life:4e3});return}s.questions=_.value.map(o=>({title:o.title,description:o.description,answer_type:o.answer_type,required:o.required,category:o.category,options:o.options.map(h=>({label:h.label,value:h.value}))})),console.log("Questions data being sent:",s.questions),s.processing=!0,s.put(route("checklists.update",s.id),{onSuccess:()=>{y.add({severity:"success",summary:"Berhasil",detail:"Checklist berhasil diperbarui.",life:3e3})},onError:o=>{console.error("Form submission errors:",o);const h=Object.values(o)[0];y.add({severity:"error",summary:"Error",detail:h||"Terjadi kesalahan saat memperbarui checklist.",life:5e3}),Object.keys(o).forEach(p=>{if(p.startsWith("questions.")){const g=p.split(".");if(g.length>=3){const C=g[1];g[2];const A=g[3];let V=o[p];Array.isArray(V)&&(V=V[0]),A!==void 0?y.add({severity:"error",summary:`Error Pertanyaan ${parseInt(C)+1} - Opsi ${parseInt(A)+1}`,detail:V,life:4e3}):y.add({severity:"error",summary:`Error Pertanyaan ${parseInt(C)+1}`,detail:V,life:4e3})}}else{let g=o[p];Array.isArray(g)&&(g=g[0]);const C={name:"Nama Checklist",sop_code:"Nomor SOP",category_id:"Kategori Checklist",branch_id:"Cabang",department_id:"Departemen",description:"Deskripsi",type:"Jenis",status:"Status",questions:"Daftar Pertanyaan"};y.add({severity:"error",summary:`Error ${C[p]||p}`,detail:g,life:4e3})}})},onFinish:()=>{s.processing=!1}})}return(l,t)=>(u(),n(S,null,[v(a(L),{title:`Edit Checklist - ${a(s).name||""}`},null,8,["title"]),v(a(X)),e("div",Y,[e("div",Z,[v(G,{items:$})]),e("div",q,[e("div",ee,[t[18]||(t[18]=e("h2",{class:"text-xl font-semibold text-gray-800"}," Informasi Checklist ",-1)),e("div",te,[e("div",null,[t[8]||(t[8]=e("label",{for:"name",class:"block mb-1 text-sm text-gray-600"},"Nama Checklist",-1)),m(e("input",{id:"name",class:k(["px-3 py-2 w-full text-sm rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",{"border-red-500":i.value.name||a(s).errors.name}]),type:"text","onUpdate:modelValue":t[0]||(t[0]=r=>a(s).name=r),placeholder:"Masukkan nama checklist",required:""},null,2),[[f,a(s).name]]),i.value.name||a(s).errors.name?(u(),n("p",se,b(i.value.name||a(s).errors.name),1)):x("",!0)]),e("div",null,[t[9]||(t[9]=e("label",{for:"sop_code",class:"block mb-1 text-sm text-gray-600"},"Nomor SOP",-1)),m(e("input",{id:"sop_code",class:k(["px-3 py-2 w-full text-sm rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",{"border-red-500":i.value.sop_code||a(s).errors.sop_code}]),type:"text","onUpdate:modelValue":t[1]||(t[1]=r=>a(s).sop_code=r),placeholder:"Masukkan kode SOP",required:""},null,2),[[f,a(s).sop_code]]),i.value.sop_code||a(s).errors.sop_code?(u(),n("p",re,b(i.value.sop_code||a(s).errors.sop_code),1)):x("",!0)]),e("div",null,[t[10]||(t[10]=e("label",{class:"block mb-1 text-sm text-gray-600"},"Kategori Checklist",-1)),v(U,{modelValue:a(s).category_id,"onUpdate:modelValue":t[2]||(t[2]=r=>a(s).category_id=r),label:"Pilih Kategori",items:w.categories,taggable:!0,class:k({"border-red-500":i.value.category_id||a(s).errors.category_id})},null,8,["modelValue","items","class"]),i.value.category_id||a(s).errors.category_id?(u(),n("p",ae,b(i.value.category_id||a(s).errors.category_id),1)):x("",!0)])]),e("div",oe,[e("div",null,[t[11]||(t[11]=e("label",{class:"block mb-1 text-sm text-gray-600"},"Cabang",-1)),v(U,{modelValue:a(s).branch_id,"onUpdate:modelValue":t[3]||(t[3]=r=>a(s).branch_id=r),label:"Pilih Cabang",items:w.branches,class:k({"border-red-500":i.value.branch_id||a(s).errors.branch_id})},null,8,["modelValue","items","class"]),i.value.branch_id||a(s).errors.branch_id?(u(),n("p",le,b(i.value.branch_id||a(s).errors.branch_id),1)):x("",!0)]),e("div",null,[t[12]||(t[12]=e("label",{class:"block mb-1 text-sm text-gray-600"},"Departemen",-1)),v(U,{modelValue:a(s).department_id,"onUpdate:modelValue":t[4]||(t[4]=r=>a(s).department_id=r),label:"Pilih Departemen",items:w.departments,class:k({"border-red-500":i.value.department_id||a(s).errors.department_id})},null,8,["modelValue","items","class"]),i.value.department_id||a(s).errors.department_id?(u(),n("p",ie,b(i.value.department_id||a(s).errors.department_id),1)):x("",!0)])]),e("div",de,[e("div",ne,[t[13]||(t[13]=e("label",{for:"description",class:"block mb-1 text-sm text-gray-600"},"Deskripsi",-1)),m(e("textarea",{id:"description","onUpdate:modelValue":t[5]||(t[5]=r=>a(s).description=r),rows:"3",class:"w-full text-sm font-medium placeholder-gray-500 text-gray-600 rounded-lg border-gray-400",placeholder:"Masukkan deskripsi checklist"},null,512),[[f,a(s).description]])]),e("div",null,[t[15]||(t[15]=e("label",{for:"type",class:"block mb-1 text-sm text-gray-600"},"Jenis",-1)),m(e("select",{id:"type","onUpdate:modelValue":t[6]||(t[6]=r=>a(s).type=r),class:k(["w-full text-sm font-medium placeholder-gray-500 text-gray-600 rounded-lg border-gray-400",{"border-red-500":a(s).errors.type}]),required:""},[...t[14]||(t[14]=[e("option",{value:"single"},"Perorang",-1),e("option",{value:"multiple"},"Banyak Orang",-1)])],2),[[j,a(s).type]]),a(s).errors.type?(u(),n("p",ue,b(a(s).errors.type),1)):x("",!0)]),e("div",null,[t[17]||(t[17]=e("label",{for:"status",class:"block mb-1 text-sm text-gray-600"},"Status",-1)),m(e("select",{id:"status","onUpdate:modelValue":t[7]||(t[7]=r=>a(s).status=r),class:k(["w-full text-sm font-medium placeholder-gray-500 text-gray-600 rounded-lg border-gray-400",{"border-red-500":a(s).errors.status}]),required:""},[...t[16]||(t[16]=[e("option",{value:"Draft"},"Draft",-1),e("option",{value:"Active"},"Active",-1),e("option",{value:"Inactive"},"Inactive",-1)])],2),[[j,a(s).status]]),a(s).errors.status?(u(),n("p",ce,b(a(s).errors.status),1)):x("",!0)])])])]),e("div",pe,[e("div",me,[t[26]||(t[26]=e("h2",{class:"text-xl font-semibold text-gray-800"}," Daftar Pertanyaan ",-1)),e("div",be,[(u(!0),n(S,null,M(_.value,(r,c)=>(u(),n("div",{key:r.uid,class:"p-4 bg-white rounded-lg border border-gray-200 shadow-sm"},[e("div",ye,[e("div",ge,[e("div",xe,[e("div",_e,[e("div",he,[e("div",ve,b(c+1),1),e("label",fe,"Pertanyaan "+b(c+1),1)]),e("label",ke,"Pertanyaan "+b(c+1),1),e("button",{type:"button",onClick:o=>z(c),class:"px-2 py-1 text-xs text-red-600 rounded border border-red-300 hover:bg-red-50"}," Hapus ",8,we)])]),e("div",Ve,[e("div",Ce,[e("div",Ue,[e("div",Pe,[m(e("input",{"onUpdate:modelValue":o=>r.title=o,type:"text",class:"block px-0 py-2.5 w-full text-sm placeholder-transparent text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 focus:border-blue-600 focus:outline-none",placeholder:"Masukkan pertanyaan"},null,8,je),[[f,r.title]]),t[19]||(t[19]=e("label",{class:"absolute top-3 -z-10 origin-[0] -translate-y-6 scale-75 transform text-sm text-gray-500"},"Pertanyaan",-1))])]),e("div",Se,[e("label",Ae,[m(e("input",{type:"checkbox","onUpdate:modelValue":o=>r.required=o,class:"sr-only peer"},null,8,Ee),[[H,r.required]]),t[20]||(t[20]=e("div",{class:"relative w-11 h-6 bg-gray-200 rounded-full peer peer-checked:bg-sky-600"},null,-1)),t[21]||(t[21]=B(" Wajib? ",-1))])])]),e("div",Te,[e("div",Oe,[e("div",Me,[m(e("input",{"onUpdate:modelValue":o=>r.description=o,type:"text",class:"block px-0 py-2.5 w-full text-sm placeholder-transparent text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 focus:border-blue-600 focus:outline-none",placeholder:"Masukkan petunjuk pertanyaan"},null,8,$e),[[f,r.description]]),t[22]||(t[22]=e("label",{class:"absolute top-3 -z-10 origin-[0] -translate-y-6 scale-75 transform text-sm text-gray-500"},"Petunjuk Pertanyaan",-1))])]),e("div",De,[v(U,{modelValue:r.category,"onUpdate:modelValue":o=>r.category=o,items:w.questionCategories,label:"Pilih Kategori",class:"w-full",taggable:!0},null,8,["modelValue","onUpdate:modelValue","items"])]),e("div",Ne,[m(e("select",{"onUpdate:modelValue":o=>r.answer_type=o,onChange:o=>N(r),class:"p-2 w-full text-gray-700 bg-white rounded-lg border border-gray-300"},[...t[23]||(t[23]=[R('<option disabled value=""> Pilih Tipe </option><option value="text"> Text </option><option value="textarea"> Textarea </option><option value="select"> Select </option><option value="radio"> Radio </option><option value="checkbox"> Checkbox </option>',6)])],40,ze),[[j,r.answer_type]])])]),["select","radio","checkbox"].includes(r.answer_type)?(u(),n("div",Ke,[t[25]||(t[25]=e("div",{class:"mb-2"},[e("h4",{class:"text-sm font-medium text-gray-700"}," Opsi Jawaban ")],-1)),e("div",Fe,[e("table",Qe,[t[24]||(t[24]=e("thead",null,[e("tr",{class:"bg-gray-50"},[e("th",{class:"p-3 text-left border-b border-gray-200"}," Label "),e("th",{class:"p-3 text-left border-b border-gray-200"}," Value "),e("th",{class:"p-3 w-20 text-center border-b border-gray-200"}," Aksi ")])],-1)),e("tbody",null,[(u(!0),n(S,null,M(r.options,(o,h)=>(u(),n("tr",{key:o.uid||h,class:"hover:bg-gray-50"},[e("td",Ie,[m(e("input",{"onUpdate:modelValue":p=>o.label=p,type:"text",class:"p-2 w-full text-sm rounded border border-gray-300",placeholder:"Label opsi"},null,8,Je),[[f,o.label]])]),e("td",Le,[m(e("input",{"onUpdate:modelValue":p=>o.value=p,type:"text",class:"p-2 w-full text-sm rounded border border-gray-300",placeholder:"Value opsi"},null,8,Be),[[f,o.value]])]),e("td",He,[e("button",{type:"button",onClick:p=>F(r,h),class:"px-2 py-1 text-xs text-red-600 rounded border border-red-300 hover:bg-red-50"}," Hapus ",8,Re)])]))),128))])])]),e("button",{type:"button",onClick:o=>K(r),class:"px-4 py-2 mt-3 text-sm text-white bg-blue-600 rounded hover:bg-blue-700"}," + Tambah Opsi ",8,We)])):x("",!0)])])])]))),128)),e("div",Ge,[e("button",{type:"button",onClick:D,class:"px-4 py-2 text-white bg-green-500 rounded"}," + Tambah Pertanyaan "),e("button",{type:"submit",onClick:Q,disabled:a(s).processing,class:"px-4 py-2 text-white bg-blue-600 rounded disabled:opacity-50 disabled:cursor-not-allowed"},b(a(s).processing?"Menyimpan...":"Simpan"),9,Xe)])])])])])],64))}});export{ct as default};
