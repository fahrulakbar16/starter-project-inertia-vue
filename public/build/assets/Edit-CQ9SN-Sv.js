import{d as _,y as $,u as E,x as q,z as h,p as M,e as u,o as m,b as g,a as e,g as l,D as O,t as i,f as b,F as B,i as W,w as C,E as P,h as z,G as R,H as G}from"./app-CJkCV51W.js";import{_ as H}from"./AppLayout-BlEKf3Fz.js";import{_ as J}from"./Breadcrumb-BJQpsGcc.js";import K from"./Form-kgokLzy3.js";import{T as L}from"./TrashIcon-DSAHmBPH.js";import{_ as Q}from"./SelectBarang-CRvJrPbK.js";import{v as w}from"./v4-BKrj-4V8.js";import"./FlashMessage-D4C-FUm8.js";import"./LayoutShell-FWpWJLvi.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useAuth-DvuTgkfF.js";import"./LayoutShell.vue_vue_type_style_index_0_lang-CRqqKi3W.js";import"./SelectPemakaian-bo5sz744.js";const X={class:"flex overflow-hidden flex-col gap-3 px-3 h-full"},Y={class:"flex justify-between items-center h-10"},Z={class:"space-y-5 overflow-hidden rounded-lg border border-gray-200 bg-white p-6 dark:border-gray-700 dark:bg-white/[0.03]"},ee={class:"flex items-center justify-between"},te={class:"font-bold text-sky-400 md:text-xl px-7"},re={class:"overflow-hidden rounded-lg border border-gray-200 bg-white dark:border-gray-700 dark:bg-white/[0.03]"},se={class:"overflow-auto","data-simplebar":""},ae={class:"min-w-full text-sm"},oe={class:"w-4 py-2.5 border-y border-gray-200 dark:border-gray-600"},de={class:"flex items-center whitespace-nowrap justify-center"},ne={class:"px-5 py-2.5 border border-gray-200 dark:border-gray-600"},ie={class:"flex flex-col py-1"},ce={class:"flex items-center justify-between"},le={class:"font-medium text-gray-900 dark:text-gray-100 text-sm"},ue={key:0,class:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full"},me={class:"text-xs text-gray-500 dark:text-gray-400"},pe={key:0,class:"text-xs text-rose-600 mt-1"},ye={class:"py-2.5 border border-gray-200 dark:border-gray-600"},ge={class:"flex items-center px-3 whitespace-nowrap justify-center"},be={class:"text-gray-500 dark:text-gray-400"},xe={class:"py-2.5 border border-gray-200 dark:border-gray-600"},_e={class:"flex items-center px-3 whitespace-nowrap justify-center"},he={class:"text-gray-500 dark:text-gray-400"},fe={class:"py-2.5 border border-gray-200 dark:border-gray-600"},ke={class:"flex items-center gap-3 ps-6 whitespace-nowrap"},ve=["onUpdate:modelValue"],qe={key:0,class:"text-xs text-rose-600 mt-1"},we={class:"py-2.5 border border-gray-200 dark:border-gray-600"},je={class:"flex items-center whitespace-nowrap justify-center"},Se=["onUpdate:modelValue"],Ue={key:0,class:"text-xs text-rose-600 mt-1"},$e={class:"py-2.5 border-y border-gray-200 dark:border-gray-600"},Be={class:"flex justify-center whitespace-nowrap px-4 gap-3"},Ce=["onClick"],Pe={key:0,class:"px-6 py-3 text-xs text-rose-600"},Ge=Object.assign({layout:H},{__name:"Edit",props:{pr:{type:Object,required:!0},requestNo:String,user:Object,materialRequests:{type:Array,required:!0},departments:{type:Array,required:!0},employees:{type:Array,required:!0},items:{type:Array,default:()=>[]},sortBy:String,sortDirection:String},setup(p){const T=[{label:"Penyimpanan"},{label:"Pengajuan Pembelian",href:route("purchase-requests.index")},{label:"Ubah Pengajuan"}],d=p;console.log(d.pr);const x=_(d.items.map(t=>({id:t.id,name:t.name,code:t.code,stock:t.stock,unit:t.unit,branch_id:t.branch_id}))),j=_(0),y=()=>{j.value++},D=$(()=>d.departments.find(t=>t.id===o.department_id)),f=$(()=>D.value?.branch_id??null),I=t=>{j.value;const s=c.value.map((r,a)=>a!==t&&r.item_id?.id?r.item_id.id:null).filter(r=>r!==null);return x.value.filter(r=>{const a=!s.includes(r.id),n=f.value?r.branch_id===f.value:!0;return a&&n})},N=(t,s)=>c.value.some((r,a)=>a!==s&&r.item_id?.id===t);function V(t){const s={id:Date.now(),name:t,code:"-",stock:0,branch_id:f.value??null};return x.value.push(s),s}function k(t){h(()=>t.item_id,s=>{console.log("bindWatcher - newVal:",s),s?(t.code=s.code,t.name=s.name,t.stock=s.stock?s.stock.last_stock:0,t.unit=s.unit):(t.code="",t.name="",t.stock=0,t.unit={})},{immediate:!0})}const c=_([]);d.pr.items&&d.pr.items.length>0&&(c.value=d.pr.items.map(t=>{const s=q({uid:w(),item_id:x.value.find(r=>r.id===t.item_id)??null,code:t.code,name:t.name,stock:t.stock?t.stock.last_stock:0,unit:t.unit,request:t.quantity_requested,note:t.note});return k(s),s}));const A=()=>{const t=q({uid:w(),item_id:null,request:1,code:"",name:"",stock:0,unit:{},note:""});k(t),c.value.push(t),y()},F=t=>{c.value.splice(t,1),y()},o=E({request_no:d.pr.request_no,requested_at:d.pr.requested_at,department_id:d.pr.department_id,employee_id:d.pr.employee_id,request_id:d.pr.request_id,requirement:d.pr.requirement,requests:[]});h(()=>o.request_id,async t=>{if(!t){c.value=[];return}const s=d.materialRequests.find(r=>r.id===t);s&&(v.value=!0,o.department_id=s.department_id??"",o.requirement=s.requirement??"",c.value=s.items.map(r=>{const a=q({uid:w(),item_id:x.value.find(n=>n.id===r.item_id)??null,code:r.code,name:r.name,stock:r.stock?r.stock.last_stock:0,unit:r.unit,request:r.quantity_requested,note:r.note});return k(a),a}),await M(),v.value=!1)}),h(c,()=>{y()},{deep:!0});const v=_(!1);h(()=>o.department_id,()=>{if(v.value){y();return}c.value.forEach(t=>{t.item_id=null,t.code="",t.name="",t.stock=0,t.unit={}}),y()});function S(){o.requests=c.value.map(t=>({uid:t.uid,item_id:t.item_id?.id??null,request:t.request,note:t.note??null})),o.put(route("purchase-requests.update",d.pr.id))}function U(){G.get(route("purchase-requests.index"))}return(t,s)=>(m(),u(B,null,[g(l(O),{title:"Ubah Pengajuan Pembelian"}),e("div",X,[e("div",Y,[g(J,{items:T})]),e("div",Z,[e("div",ee,[s[0]||(s[0]=e("div",{class:"font-bold text-gray-700 md:text-xl dark:text-gray-300"}," Ubah Pengajuan Pembelian ",-1)),e("div",te,i(l(o).request_no),1)]),g(K,{form:l(o),materialRequests:p.materialRequests,departments:p.departments,employees:p.employees,user:p.user,onSubmit:S,onCancel:U},null,8,["form","materialRequests","departments","employees","user"])]),e("div",re,[s[3]||(s[3]=e("div",{class:"flex items-center justify-between px-6 py-4"},[e("div",{class:"font-semibold text-gray-700 dark:text-gray-200"}," Daftar Item ")],-1)),e("div",se,[e("table",ae,[s[2]||(s[2]=e("thead",null,[e("tr",null,[e("th",{class:"py-2.5 border-y border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800"},[e("div",{class:"flex items-center justify-center"},[e("p",{class:"flex flex-col items-center font-medium text-gray-500 whitespace-nowrap dark:text-gray-400"}," No. ")])]),e("th",{class:"py-3 border cursor-pointer border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800"},[e("div",{class:"flex items-center justify-center gap-2 px-3"},[e("p",{class:"font-medium text-gray-500 whitespace-nowrap dark:text-gray-400"}," Nama Barang ")])]),e("th",{class:"py-3 border border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800"},[e("div",{class:"flex cursor-pointer items-center justify-center gap-2 px-3"},[e("p",{class:"font-medium whitespace-nowrap text-gray-500 dark:text-gray-400"}," Kode Barang ")])]),e("th",{class:"py-3 border cursor-pointer border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800"},[e("div",{class:"flex items-center justify-center gap-2 px-3"},[e("p",{class:"font-medium text-gray-500 whitespace-nowrap dark:text-gray-400"}," Stok Tersedia ")])]),e("th",{class:"py-3 border cursor-pointer border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800"},[e("div",{class:"flex items-center justify-center gap-2 px-3"},[e("p",{class:"font-medium text-gray-500 whitespace-nowrap dark:text-gray-400"}," Jumlah Pengajuan ")])]),e("th",{class:"py-3 border cursor-pointer border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800"},[e("div",{class:"flex items-center justify-center gap-2 px-3"},[e("p",{class:"font-medium text-gray-500 whitespace-nowrap dark:text-gray-400"}," Catatan ")])]),e("th",{class:"border-y border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-800"},[e("div",{class:"flex items-center justify-center"},[e("p",{class:"font-medium text-gray-500 whitespace-nowrap dark:text-gray-400"}," Aksi ")])])])],-1)),e("tbody",null,[(m(!0),u(B,null,W(c.value,(r,a)=>(m(),u("tr",{key:r.uid,class:"hover:bg-gray-100 cursor-pointer dark:hover:bg-gray-800"},[e("td",oe,[e("div",de,i(a+1)+". ",1)]),e("td",ne,[g(Q,{modelValue:r.item_id,"onUpdate:modelValue":n=>r.item_id=n,items:I(a),taggable:!0,"search-key":"name","label-key":"name",label:"Cari Barang",onTag:V,class:"w-full"},{item:C(({item:n})=>[e("div",ie,[e("div",ce,[e("span",le,i(n.name),1),N(n.id,a)?(m(),u("span",ue," Dipilih ")):b("",!0)]),e("span",me,i(n.code||"-"),1)])]),"no-options":C(()=>[...s[1]||(s[1]=[e("div",{class:"text-sm text-gray-500 p-2"}," Semua barang telah dipilih di baris lain ",-1)])]),_:2},1032,["modelValue","onUpdate:modelValue","items"]),l(o).errors[`requests.${a}.item_id`]?(m(),u("div",pe,i(l(o).errors[`requests.${a}.item_id`][0]),1)):b("",!0)]),e("td",ye,[e("div",ge,[e("p",be,i(r.code),1)])]),e("td",xe,[e("div",_e,[e("p",he,i(r.stock)+" "+i(r.unit?.short_name),1)])]),e("td",fe,[e("div",ke,[P(e("input",{"onUpdate:modelValue":n=>r.request=n,type:"number",min:"0",class:"w-24 rounded border-gray-300 dark:border-gray-700 dark:bg-gray-800 dark:text-white/90"},null,8,ve),[[R,r.request]]),z(" "+i(r.unit?.short_name),1)]),l(o).errors[`requests.${a}.request`]?(m(),u("div",qe,i(l(o).errors[`requests.${a}.request`]),1)):b("",!0)]),e("td",we,[e("div",je,[P(e("input",{"onUpdate:modelValue":n=>r.note=n,type:"text",placeholder:"Masukkan catatan",class:"w-40 h-10 text-sm rounded placeholder:text-gray-600 border-gray-300 dark:border-gray-700 dark:bg-gray-800 dark:text-white/90"},null,8,Se),[[R,r.note]])]),l(o).errors[`requests.${a}.note`]?(m(),u("div",Ue,i(l(o).errors[`requests.${a}.note`]),1)):b("",!0)]),e("td",$e,[e("div",Be,[e("button",{onClick:n=>F(a)},[g(L,{class:"text-red-500"})],8,Ce)])])]))),128))])]),e("button",{type:"button",onClick:A,class:"m-4 px-3 py-2 text-white bg-green-500 hover:bg-green-600 rounded whitespace-nowrap"}," + Tambah Item ")]),l(o).errors.requests?(m(),u("div",Pe,i(l(o).errors.requests[0]),1)):b("",!0)]),e("div",{class:"flex items-center gap-5 justify-end"},[e("button",{type:"button",onClick:U,class:"inline-flex items-center rounded border bg-gray-400 border-gray-300 px-5 py-2 text-sm text-white hover:text-gray-800 hover:bg-gray-300 dark:border-gray-700 dark:text-gray-300"}," Batal "),e("button",{onClick:S,class:"inline-flex items-center rounded bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 disabled:opacity-60"}," Simpan Perubahan ")])])],64))}});export{Ge as default};
